<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Helvetic AI Chatbot</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .chatbot-window {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 350px;
    max-height: 80vh;
    background: white;
    border-radius: 16px;
    display: none; /* Masqué par défaut */
    flex-direction: column;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    overflow: hidden;
    z-index: 9998;
  }
  .chat-background {
    background: url("mountains.svg") no-repeat center center;
    background-size: cover;
    position: relative;
  }
  .chat-background::before {
    content: "";
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(255,255,255,0.6);
    backdrop-filter: blur(3px);
    z-index: 0;
  }
  #chatbot-messages > div {
    position: relative;
    z-index: 1;
  }
  .line-clamp-5 {
    display: -webkit-box;
    -webkit-line-clamp: 5;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
<script src="faq.js"></script>
</head>
<body class="bg-gray-100">

<!-- Fenêtre chatbot -->
<div id="chatbot-window" class="chatbot-window">
  <!-- Header -->
  <div class="bg-red-600 text-white flex justify-between items-center p-3">
    <div class="flex items-center space-x-2">
      <img src="flags/switzerland.svg" alt="Swiss Flag" class="w-6 h-6 rounded">
      <span class="font-bold">Helvetic AI</span>
    </div>
    <div class="relative">
      <select id="lang-select" class="appearance-none text-gray-800 rounded-lg px-3 py-1 text-xs font-medium pr-6 focus:outline-none">
        <option value="fr" data-flag="flags/france.svg">Français</option>
        <option value="en" data-flag="flags/uk.svg">English</option>
        <option value="de" data-flag="flags/germany.svg">Deutsch</option>
        <option value="ch" data-flag="flags/switzerland.svg">Suisse</option>
      </select>
    </div>
  </div>

  <!-- Messages -->
  <div id="chatbot-messages" class="flex-1 overflow-y-auto p-3 space-y-2 chat-background"></div>

  <!-- Questions rapides -->
  <div class="border-t border-gray-200 bg-white/80 backdrop-blur-sm p-3">
    <div class="text-xs font-semibold text-gray-700 mb-2">❓ Questions rapides :</div>
    <div id="questions-container" class="space-y-2"></div>
  </div>

  <!-- Input -->
  <div class="border-t border-gray-300 bg-white p-2 flex items-center space-x-2">
    <input id="user-input" type="text" placeholder="Posez votre question..." class="flex-1 p-2 border rounded-lg text-sm"/>
    <button onclick="handleUserInput()" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">Envoyer</button>
  </div>
</div>

<script>
let currentLang="fr", conversationHistory=[];

// Ajoute un message
function addMessage(text, sender="bot", isWelcome=false){
  const wrapper=document.createElement("div");
  wrapper.className=sender==="user"?"text-right":"text-left";
  const bubble=document.createElement("div");

  if(sender==="user"){
    bubble.className="inline-block px-3 py-2 rounded-2xl max-w-xs text-sm font-medium bg-red-600 text-white";
  }else{
    bubble.className="inline-block px-3 py-2 rounded-2xl max-w-xs text-sm font-medium bg-white/90 text-gray-800 whitespace-pre-line";
  }

  if(isWelcome){
    bubble.innerHTML=`<div id="welcome-preview" class="line-clamp-5">${text}</div>
    <button id="toggleWelcome" class="mt-1 text-red-600 text-xs underline">Lire plus</button>`;
    setTimeout(()=>{
      const btn=document.getElementById("toggleWelcome");
      const preview=document.getElementById("welcome-preview");
      btn.addEventListener("click",()=>{
        if(btn.textContent==="Lire plus"){
          preview.classList.remove("line-clamp-5");
          btn.textContent="Lire moins";
        }else{
          preview.classList.add("line-clamp-5");
          btn.textContent="Lire plus";
        }
      });
    },100);
  }else{
    bubble.textContent=text;
  }

  wrapper.appendChild(bubble);
  document.getElementById("chatbot-messages").appendChild(wrapper);
  document.getElementById("chatbot-messages").scrollTop=document.getElementById("chatbot-messages").scrollHeight;
  conversationHistory.push({sender,text,time:new Date().toISOString()});
}

// Gestion input user
function handleUserInput(){
  const input=document.getElementById("user-input");
  const q=input.value.trim();
  if(!q) return;
  addMessage(q,"user");
  input.value="";
  setTimeout(()=>{
    const a=getAnswer(q,currentLang) || "Désolé, je n’ai pas encore de réponse pour ça.";
    addMessage(a,"bot");
  },800);
}

// Questions rapides
function updateQuickQuestions(){
  const container=document.getElementById("questions-container");
  container.innerHTML="";
  const questions=quickQuestions[currentLang]||[];
  questions.forEach(q=>{
    const btn=document.createElement("button");
    btn.className="w-full text-left p-2 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-100";
    btn.textContent=q;
    btn.onclick=()=>{addMessage(q,"user"); setTimeout(()=>addMessage(getAnswer(q,currentLang),"bot"),800);};
    container.appendChild(btn);
  });
}

// Init
document.addEventListener("DOMContentLoaded",()=>{
  addMessage(translations[currentLang].welcome,"bot",true);
  updateQuickQuestions();
});

// Gestion langues
document.getElementById("lang-select").addEventListener("change",e=>{
  currentLang=e.target.value;
  document.getElementById("chatbot-messages").innerHTML="";
  conversationHistory=[];
  addMessage(translations[currentLang].welcome,"bot",true);
  updateQuickQuestions();
});

// Drapeaux SVG dans select
function updateLangFlags(){
  const select=document.getElementById("lang-select");
  select.querySelectorAll("option").forEach(opt=>{
    const flag=opt.getAttribute("data-flag");
    if(flag){
      opt.textContent="";
      const img=document.createElement("img");
      img.src=flag;
      img.style.width="16px";
      img.style.height="16px";
      img.style.verticalAlign="middle";
      opt.appendChild(img);
      opt.append(" "+opt.value.toUpperCase());
    }
  });
}
document.addEventListener("DOMContentLoaded", updateLangFlags);
</script>
</body>
</html>
