<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Helvetic AI Chatbot</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .dropdown { position: relative; display: inline-block; }
  .dropdown-content {
    display: none; position: absolute; right: 0; background: white;
    min-width: 140px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    border-radius: 6px; z-index: 100;
  }
  .dropdown-content button {
    width: 100%; text-align: left; padding: 8px 12px; border: none;
    background: none; cursor: pointer; font-size: 0.875rem;
  }
  .dropdown-content button:hover { background: #f3f4f6; }
  .dropdown.show .dropdown-content { display: block; }

  /* Coupe le message aprÃ¨s 5 lignes */
  .line-clamp-5 {
    display: -webkit-box;
    -webkit-line-clamp: 5;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .glass-effect {
  background: rgba(255, 255, 255, 0.15); /* blanc transparent */
  backdrop-filter: blur(10px); /* flou */
  -webkit-backdrop-filter: blur(10px); /* compatibilitÃ© Safari */
  border: 1px solid rgba(255, 255, 255, 0.3); /* bordure lÃ©gÃ¨re */
}
  .message-bubble-bot,
.message-bubble-user {
  color: #1e40af !important; /* bleu indigo foncÃ© */

</style>
</head>
<body>

<!-- FenÃªtre du chatbot -->
<div id="chatbot-window" class="w-full h-screen glass-effect flex flex-col relative overflow-hidden">
  <!-- Header -->
  <div class="gradient-bg text-white flex justify-between items-center p-4 shadow-2xl relative z-10">
    <div class="flex items-center space-x-2 sm:space-x-4">
      <div class="logo-container w-10 h-10 rounded-full flex items-center justify-center overflow-hidden">
        <svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" fill="#FF0000" rx="4"/>
          <rect x="6" y="13" width="20" height="6" fill="#FFFFFF" rx="1"/>
          <rect x="13" y="6" width="6" height="20" fill="#FFFFFF" rx="1"/>
        </svg>
      </div>
      <div class="min-w-0 flex-1">
        <span class="font-bold text-base sm:text-lg">Helvetic AI</span>
        <div class="text-xs sm:text-sm opacity-90 status-pulse pl-3 truncate" id="status-indicator">En ligne</div>
      </div>
    </div>
    <div class="flex items-center space-x-2 sm:space-x-3">
      <!-- Bouton Export avec menu dÃ©roulant -->
      <div class="dropdown" id="exportDropdown">
        <button onclick="toggleDropdown()" class="px-3 py-1 bg-white/20 rounded text-sm">ðŸ’¾ Exporter</button>
        <div class="dropdown-content">
          <button onclick="exportConversation('txt')">ðŸ“„ Exporter en TXT</button>
          <button onclick="exportConversation('json')">ðŸ“‚ Exporter en JSON</button>
        </div>
      </div>

      <!-- Choix langue -->
      <select id="lang-select" class="lang-select text-gray-800 rounded-lg px-3 py-2 text-xs sm:text-sm font-medium appearance-none pr-6 sm:pr-8 focus:outline-none focus:ring-2 focus:ring-white/50">
        <option value="fr">ðŸ‡«ðŸ‡· FR</option>
        <option value="en">ðŸ‡¬ðŸ‡§ EN</option>
        <option value="de">ðŸ‡©ðŸ‡ª DE</option>
      </select>
      <button onclick="parent.closeChatbot()" class="close-btn w-8 h-8 rounded-full flex items-center justify-center text-lg font-bold">Ã—</button>
    </div>
  </div>

  <!-- Messages -->
  <div id="chatbot-messages" class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-3 sm:space-y-4 scrollbar-thin chat-background"></div>


  <!-- Questions rapides -->
  <div class="border-t border-gray-200 bg-white/80 backdrop-blur-sm p-4 sm:p-6">
    <div class="text-xs sm:text-sm font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center" id="questions-title">
      <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      Questions rapides :
    </div>
    <div id="questions-container" class="space-y-2 sm:space-y-3"></div>
  </div>

  <!-- Champ de saisie utilisateur -->
  <div class="border-t border-gray-300 bg-white p-3 flex items-center space-x-2">
    <input id="user-input" type="text" placeholder="Posez votre question..." class="flex-1 p-2 border rounded-lg text-sm"/>
    <button onclick="handleUserInput()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Envoyer</button>
  </div>
</div>

<!-- Scripts -->
<script>
/* ==========================
   QUESTIONS / RÃ‰PONSES
   ========================== */
const quickQuestions = {
  fr: ["Qu'est-ce que l'IA en finance ?", "Combien coÃ»te une implÃ©mentation IA ?"],
  en: ["What is AI in finance?", "How much does AI implementation cost?"],
  de: ["Was ist KI im Finanzwesen?", "Wie viel kostet eine KI-Implementierung?"]
};

const translations = {
  fr: { 
    welcome: `âœ¨ Helvetic AI â€“ Lâ€™intelligence artificielle au service de la performance financiÃ¨re âœ¨

Helvetic AI accompagne les directions financiÃ¨res dans leur transformation digitale.
Notre ambition : mettre la puissance de lâ€™intelligence artificielle et de lâ€™Enterprise Performance Management (EPM) au service des dÃ©cideurs, pour transformer la donnÃ©e en vÃ©ritable levier stratÃ©gique.

ðŸ”¹ Une expertise unique : rigueur suisse + approche pragmatique et orientÃ©e rÃ©sultats.
ðŸ”¹ Des solutions concrÃ¨tes : automatisation des processus, analyse prÃ©dictive, optimisation budgÃ©taire, pilotage de la performance.
ðŸ”¹ Un engagement fort : fiabilitÃ© opÃ©rationnelle, innovation maÃ®trisÃ©e, conformitÃ© rÃ©glementaire.

ðŸ‘‰ Avec Helvetic AI, la performance financiÃ¨re devient plus intelligente, plus rapide et plus sÃ»re.`,
    online: "En ligne",
    readMore: "Lire plus",
    readLess: "Lire moins"
  },
  en: { 
    welcome: `âœ¨ Helvetic AI â€“ Artificial Intelligence at the service of financial performance âœ¨

Helvetic AI supports CFOs in their digital transformation, turning data into a real strategic lever through AI and EPM.

ðŸ”¹ Unique expertise: Swiss precision combined with pragmatic, results-oriented methods.
ðŸ”¹ Concrete solutions: automation, predictive analysis, budgeting optimization, performance management.
ðŸ”¹ Strong commitment: operational reliability, controlled innovation, full compliance.

ðŸ‘‰ With Helvetic AI, financial performance becomes smarter, faster and safer.`,
    online: "Online",
    readMore: "Read more",
    readLess: "Read less"
  },
  de: { 
    welcome: `âœ¨ Helvetic AI â€“ KÃ¼nstliche Intelligenz im Dienste der Finanzperformance âœ¨

Helvetic AI begleitet Finanzdirektionen bei der digitalen Transformation und macht Daten dank KI und EPM zu einem echten strategischen Hebel.

ðŸ”¹ Einzigartige Expertise: Schweizer PrÃ¤zision + pragmatische, ergebnisorientierte AnsÃ¤tze.
ðŸ”¹ Konkrete LÃ¶sungen: Automatisierung, prÃ¤diktive Analysen, Budgetoptimierung, Performance-Steuerung.
ðŸ”¹ Starkes Engagement: operative ZuverlÃ¤ssigkeit, kontrollierte Innovation, volle Compliance.

ðŸ‘‰ Mit Helvetic AI wird die Finanzperformance intelligenter, schneller und sicherer.`,
    online: "Online",
    readMore: "Mehr lesen",
    readLess: "Weniger lesen"
  }
};

const responses = {
  fr: { "Qu'est-ce que l'IA en finance ?": "L'IA en finance transforme la gestion financiÃ¨re...", "Combien coÃ»te une implÃ©mentation IA ?": "Nos solutions commencent Ã  partir de 15 000 CHF..." },
  en: { "What is AI in finance?": "AI in finance transforms financial management...", "How much does AI implementation cost?": "Our solutions start from CHF 15,000..." },
  de: { "Was ist KI im Finanzwesen?": "KI im Finanzwesen transformiert das Finanzmanagement...", "Wie viel kostet eine KI-Implementierung?": "Unsere LÃ¶sungen beginnen bei CHF 15.000..." }
};

/* ==========================
   VARIABLES
   ========================== */
let currentLang = "fr";
let conversationHistory = [];

/* ==========================
   FONCTIONS
   ========================== */
function addMessage(text, sender = "bot", isWelcome = false) {
  const msg = document.createElement("div");
  msg.className = sender === "user" ? "text-right" : "text-left";

  const bubble = document.createElement("div");
  bubble.className = sender === "user"
    ? "inline-block px-4 py-3 rounded-2xl max-w-xs lg:max-w-md text-sm font-medium message-bubble-user text-white"
    : "inline-block px-4 py-3 rounded-2xl max-w-xs lg:max-w-md text-sm font-medium message-bubble-bot text-gray-800 whitespace-pre-line";

  if (isWelcome) {
    bubble.innerHTML = `
      <div id="welcome-preview" class="line-clamp-5">${text}</div>
      <button id="toggleWelcome" class="mt-2 text-indigo-600 text-xs underline">
        ${translations[currentLang].readMore}
      </button>
    `;

    setTimeout(() => {
      const btn = document.getElementById("toggleWelcome");
      const preview = document.getElementById("welcome-preview");
      btn.addEventListener("click", () => {
        if (btn.textContent === translations[currentLang].readMore) {
          preview.classList.remove("line-clamp-5");
          btn.textContent = translations[currentLang].readLess;
        } else {
          preview.classList.add("line-clamp-5");
          btn.textContent = translations[currentLang].readMore;
        }
      });
    }, 50);
  } else {
    bubble.textContent = text;
  }

  msg.appendChild(bubble);
  document.getElementById("chatbot-messages").appendChild(msg);
  document.getElementById("chatbot-messages").scrollTop = document.getElementById("chatbot-messages").scrollHeight;
  conversationHistory.push({ sender, text, time: new Date().toISOString() });
}

function handleUserInput() {
  const inputEl = document.getElementById("user-input");
  const input = inputEl.value.trim();
  if (!input) return;
  addMessage(input, "user");
  inputEl.value = "";
  setTimeout(() => {
    const response = responses[currentLang][input] || "DÃ©solÃ©, je nâ€™ai pas encore de rÃ©ponse pour Ã§a.";
    addMessage(response, "bot");
  }, 800);
}

function updateQuickQuestions() {
  const container = document.getElementById("questions-container");
  container.innerHTML = "";
  quickQuestions[currentLang].forEach((q) => {
    const btn = document.createElement("button");
    btn.className = "question-btn w-full text-left p-3 rounded-xl text-sm font-medium text-gray-700";
    btn.textContent = q;
    btn.onclick = () => { addMessage(q, "user"); setTimeout(() => addMessage(responses[currentLang][q], "bot"), 800); };
    container.appendChild(btn);
  });
}

function exportConversation(format = "txt") {
  if (conversationHistory.length === 0) return alert("Aucune conversation Ã  exporter.");
  let content, blob, filename;
  if (format === "json") {
    content = JSON.stringify(conversationHistory, null, 2);
    blob = new Blob([content], { type: "application/json" });
    filename = "conversation.json";
  } else {
    content = conversationHistory.map(m => `[${m.time}] ${m.sender.toUpperCase()}: ${m.text}`).join("\n");
    blob = new Blob([content], { type: "text/plain" });
    filename = "conversation.txt";
  }
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
  document.getElementById("exportDropdown").classList.remove("show");
}

function toggleDropdown() {
  document.getElementById("exportDropdown").classList.toggle("show");
}

/* ==========================
   INIT
   ========================== */
document.addEventListener("DOMContentLoaded", () => {
  addMessage(translations[currentLang].welcome, "bot", true);
  updateQuickQuestions();
});

document.getElementById("lang-select").addEventListener("change", (e) => {
  currentLang = e.target.value;
  document.getElementById("status-indicator").textContent = translations[currentLang].online;
  document.getElementById("chatbot-messages").innerHTML = "";
  conversationHistory = [];
  addMessage(translations[currentLang].welcome, "bot", true);
  updateQuickQuestions();
});

window.addEventListener("click", (e) => {
  if (!e.target.closest("#exportDropdown")) {
    document.getElementById("exportDropdown").classList.remove("show");
  }
});
</script>
</body>
</html>
