<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HelveticBot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      background: transparent !important;
    }
    .chat-container {height: calc(100vh - 140px);}
    .fade-in-up {animation: fadeInUp 0.5s ease-out;}
    @keyframes fadeInUp {from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
  </style>
</head>
<body class="bg-transparent">

  <!-- Header -->
  <div class="bg-white shadow-lg border-b border-blue-100 flex justify-between items-center p-3">
    <h1 class="text-xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent">
      HelveticBot
    </h1>
    <button onclick="closeWindow()" class="text-red-500 font-bold text-lg">‚úñ</button>
  </div>

  <!-- Chat Container -->
  <div class="flex flex-col chat-container max-w-4xl mx-auto bg-transparent">
    <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-6">
      <!-- Message de bienvenue -->
      <div class="flex justify-start">
        <div class="bg-white border border-blue-100 rounded-2xl p-4 shadow-lg">
          Bonjour üëã Je suis <strong class="text-blue-800">HelveticBot</strong>, votre assistant IA financier üá®üá≠
          <br><br>
          Je peux vous aider avec :<br>
          ‚Ä¢ Analyses financi√®res<br>
          ‚Ä¢ Pr√©visions budg√©taires<br>
          ‚Ä¢ Automatisation<br>
          ‚Ä¢ Strat√©gie
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="border-t border-gray-200 bg-white p-3 flex items-end space-x-3">
      <textarea id="userInput" placeholder="Posez votre question..." class="flex-1 p-3 border rounded-2xl focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
      <button id="sendBtn" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-3 rounded-2xl">‚û§</button>
    </div>
  </div>

  <!-- Footer -->
  <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-2 text-center text-xs">
    ‚ö° Propuls√© par Helvetic AI ‚Ä¢ Donn√©es s√©curis√©es
  </div>

  <script>
    const chatMessages = document.getElementById("chatMessages");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");

    function addMessage(type, content) {
      const div = document.createElement("div");
      div.className = `flex ${type === "user" ? "justify-end" : "justify-start"} fade-in-up`;
      const bubble = document.createElement("div");
      bubble.className = `${type === "user" ? "bg-gray-700 text-white" : "bg-white border border-blue-100"} rounded-2xl p-4 shadow-lg max-w-xl`;
      bubble.innerHTML = content;
      div.appendChild(bubble);
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function botResponse(msg) {
      if (msg.toLowerCase().includes("budget")) {
        return "üìà Pr√©vision budg√©taire :<br>‚Ä¢ Machine Learning<br>‚Ä¢ Donn√©es √©conomiques<br>‚Ä¢ Sc√©narios multi-variantes";
      }
      if (msg.toLowerCase().includes("analyse")) {
        return "üìä Analyse financi√®re :<br>‚Ä¢ Collecte des donn√©es<br>‚Ä¢ Ratios cl√©s<br>‚Ä¢ Benchmark sectoriel";
      }
      return "ü§ñ Je suis HelveticBot. Posez-moi vos questions financi√®res üá®üá≠";
    }

    function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage("user", text);
      userInput.value = "";
      setTimeout(() => {
        addMessage("bot", botResponse(text));
      }, 800);
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keypress", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // === CORRECTION : fonction close ===
    function closeWindow() {
      if (window.parent) {
        window.parent.postMessage({ action: "closeChatbot" }, "*");
      }
    }
  </script>
</body>
</html>
