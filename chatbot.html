<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Helvetic AI Chatbot</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

* { font-family: 'Inter', sans-serif; }

.dropdown{position:relative;display:inline-block}
.dropdown-content{display:none;position:absolute;right:0;background:#fff;min-width:160px;box-shadow:0 8px 32px rgba(0,0,0,.15);border-radius:12px;z-index:100;border:1px solid rgba(0,0,0,.1)}
.dropdown-content button{width:100%;text-align:left;padding:12px 16px;border:none;background:none;cursor:pointer;font-size:.875rem;transition:all 0.2s}
.dropdown-content button:hover{background:#f8fafc;color:#4f46e5}
.dropdown.show .dropdown-content{display:block;animation:slideDown 0.2s ease}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.line-clamp-5{display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical;overflow:hidden}

.chat-background{
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  position: relative;
}

.chat-background::before{
  content:"";
  position:absolute;
  top:0;left:0;right:0;bottom:0;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(10px);
  z-index:0
}

#chatbot-messages>div{position:relative;z-index:1}

.message-bubble-bot, .message-bubble-user{
  animation: messageSlide 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

@keyframes messageSlide {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.typing-indicator {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: rgba(255,255,255,0.9);
  border-radius: 18px;
  margin: 8px 0;
  max-width: fit-content;
  animation: messageSlide 0.3s ease;
}

.typing-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #9ca3af;
  margin: 0 2px;
  animation: typingAnimation 1.4s infinite;
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingAnimation {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
  30% { transform: translateY(-10px); opacity: 1; }
}

.gradient-header {
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  position: relative;
  overflow: hidden;
}

.gradient-header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  animation: shimmer 3s linear infinite;
}

@keyframes shimmer {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.status-pulse {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 1; }
}

.question-btn {
  transition: all 0.3s ease;
  border: 1px solid rgba(79, 70, 229, 0.2);
}

.question-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(79, 70, 229, 0.15);
  border-color: #4f46e5;
}

.input-container {
  position: relative;
  background: #ffffff;
  border-radius: 24px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  border: 2px solid #4f46e5;
  transition: all 0.3s ease;
  min-height: 56px;
  max-height: 200px;
}

.input-container:focus-within {
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4);
  border-color: #4f46e5;
}

.text-input-wrapper {
  display: flex;
  align-items: flex-start;
  max-height: 160px;
  overflow-y: auto;
  padding: 2px;
}

.text-input-wrapper::-webkit-scrollbar {
  width: 6px;
}

.text-input-wrapper::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.05);
  border-radius: 3px;
}

.text-input-wrapper::-webkit-scrollbar-thumb {
  background: rgba(79, 70, 229, 0.3);
  border-radius: 3px;
  transition: background 0.3s ease;
}

.text-input-wrapper::-webkit-scrollbar-thumb:hover {
  background: rgba(79, 70, 229, 0.5);
}

.voice-btn {
  transition: all 0.3s ease;
}

.voice-btn:hover {
  background: #ef4444;
  transform: scale(1.1);
}

.voice-recording {
  background: #ef4444 !important;
  animation: pulse 1s infinite;
}

.attachment-preview {
  max-width: 200px;
  max-height: 100px;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.sentiment-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 8px;
}

.sentiment-positive { background: #10b981; }
.sentiment-neutral { background: #6b7280; }
.sentiment-negative { background: #ef4444; }

.theme-dark {
  background: #1f2937;
  color: #f9fafb;
}

.theme-dark .chat-background::before {
  background: rgba(31, 41, 55, 0.95);
}

.theme-dark .message-bubble-bot {
  background: #374151;
  color: #f9fafb;
}

.theme-dark .input-container {
  background: #374151;
  border-color: #4b5563;
}

.satisfaction-rating {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.rating-star {
  cursor: pointer;
  font-size: 18px;
  color: #d1d5db;
  transition: all 0.2s ease;
}

.rating-star:hover,
.rating-star.active {
  color: #fbbf24;
  transform: scale(1.2);
}

.message-actions {
  opacity: 0;
  transition: opacity 0.3s ease;
  margin-top: 8px;
  display: flex;
  gap: 8px;
}

.message-container:hover .message-actions {
  opacity: 1;
}

.action-btn {
  padding: 4px 8px;
  background: rgba(0,0,0,0.05);
  border: none;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.action-btn:hover {
  background: rgba(0,0,0,0.1);
}

.quick-actions {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.quick-action {
  padding: 8px 16px;
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  color: white;
  border: none;
  border-radius: 20px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.quick-action:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
}

.conversation-stats {
  position: absolute;
  top: 100%;
  right: 0;
  background: white;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
  padding: 16px;
  min-width: 200px;
  z-index: 1000;
  display: none;
}

.progress-bar {
  width: 100%;
  height: 4px;
  background: rgba(0,0,0,0.1);
  border-radius: 2px;
  overflow: hidden;
  margin-top: 8px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #4f46e5, #7c3aed);
  transition: width 0.3s ease;
}

@media (max-width: 640px) {
  .quick-actions {
    justify-content: center;
  }
  
  .dropdown-content {
    min-width: 120px;
  }
  
  #search-input::placeholder {
    font-size: 12px;
  }
}

.search-result-item {
  padding: 8px 12px;
  cursor: pointer;
  border-bottom: 1px solid #f3f4f6;
  transition: background-color 0.2s ease;
  font-size: 13px;
}

.search-result-item:last-child {
  border-bottom: none;
}

.search-result-item:hover {
  background-color: #f8fafc;
}

.search-result-question {
  font-weight: 500;
  color: #374151;
}

.search-result-preview {
  color: #6b7280;
  font-size: 12px;
  margin-top: 2px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.search-highlight {
  background-color: #fef3c7;
  font-weight: 600;
  padding: 0 2px;
  border-radius: 2px;
}

.no-results {
  padding: 16px;
  text-align: center;
  color: #6b7280;
  font-size: 13px;
}

#search-results {
  scrollbar-width: thin;
  scrollbar-color: rgba(79, 70, 229, 0.3) transparent;
}

#search-results::-webkit-scrollbar {
  width: 4px;
}

#search-results::-webkit-scrollbar-track {
  background: transparent;
}

#search-results::-webkit-scrollbar-thumb {
  background: rgba(79, 70, 229, 0.3);
  border-radius: 2px;
}

/* Nouvelles animations et am√©liorations */
.loading-spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid #f3f3f3;
  border-top: 2px solid #4f46e5;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.error-message {
  background: linear-gradient(135deg, #fef2f2, #fecaca);
  border: 1px solid #f87171;
  color: #991b1b;
  padding: 12px;
  border-radius: 8px;
  margin: 8px 0;
  font-size: 14px;
}

.success-message {
  background: linear-gradient(135deg, #f0fdf4, #bbf7d0);
  border: 1px solid #4ade80;
  color: #166534;
  padding: 12px;
  border-radius: 8px;
  margin: 8px 0;
  font-size: 14px;
}

.context-menu {
  position: absolute;
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  padding: 4px 0;
  z-index: 1000;
  min-width: 120px;
}

.context-menu button {
  width: 100%;
  text-align: left;
  padding: 8px 12px;
  border: none;
  background: none;
  font-size: 13px;
  cursor: pointer;
  transition: background 0.2s;
}

.context-menu button:hover {
  background: #f3f4f6;
}

.ai-thinking {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: rgba(79, 70, 229, 0.1);
  border-radius: 12px;
  margin: 8px 0;
  font-size: 13px;
  color: #4f46e5;
}

.confidence-indicator {
  width: 100%;
  height: 3px;
  background: rgba(0,0,0,0.1);
  border-radius: 2px;
  overflow: hidden;
  margin-top: 4px;
}

.confidence-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.5s ease;
}

.confidence-high { background: #10b981; }
.confidence-medium { background: #f59e0b; }
.confidence-low { background: #ef4444; }

.conversation-backup {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #4f46e5;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 12px;
  z-index: 1000;
  animation: slideDown 0.3s ease;
}

.smart-suggestion {
  background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
  border: 1px solid #0ea5e9;
  border-radius: 8px;
  padding: 8px 12px;
  margin: 4px 0;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.smart-suggestion:hover {
  background: linear-gradient(135deg, #e0f2fe, #bae6fd);
  transform: translateY(-1px);
}

.message-timestamp {
  font-size: 10px;
  color: #9ca3af;
  margin-top: 4px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.message-container:hover .message-timestamp {
  opacity: 1;
}

.feature-highlight {
  position: relative;
  animation: highlight 2s ease-in-out;
}

@keyframes highlight {
  0%, 100% { background: transparent; }
  50% { background: rgba(79, 70, 229, 0.1); }
}

.connection-status {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  opacity: 0.8;
}

.status-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #10b981;
  animation: pulse 2s infinite;
}

.status-offline { background: #ef4444; }
.status-connecting { background: #f59e0b; animation: pulse 0.5s infinite; }

.advanced-search {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #6b7280;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.advanced-search:hover {
  background: #f3f4f6;
  color: #4f46e5;
}

.smart-compose {
  position: absolute;
  right: 80px;
  top: 50%;
  transform: translateY(-50%);
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s ease;
  opacity: 0;
}

.smart-compose.show {
  opacity: 1;
}

.smart-compose:hover {
  transform: translateY(-50%) scale(1.05);
}
</style>
</head>
<body>
<!-- Notification Toast -->
<div id="notification-toast" class="fixed top-4 right-4 z-50 hidden">
  <div class="bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm">
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <i id="toast-icon" class="fas fa-info-circle text-blue-500"></i>
      </div>
      <div class="ml-3 w-0 flex-1">
        <p id="toast-message" class="text-sm font-medium text-gray-900"></p>
        <p id="toast-description" class="mt-1 text-sm text-gray-500"></p>
      </div>
      <div class="ml-4 flex-shrink-0 flex">
        <button onclick="hideNotification()" class="bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Context Menu -->
<div id="context-menu" class="context-menu hidden">
  <button onclick="copySelectedText()"><i class="fas fa-copy mr-2"></i>Copier</button>
  <button onclick="searchSelectedText()"><i class="fas fa-search mr-2"></i>Rechercher</button>
  <button onclick="translateSelectedText()"><i class="fas fa-language mr-2"></i>Traduire</button>
</div>

<div id="chatbot-window" class="w-full h-screen flex flex-col relative overflow-hidden">
  <!-- Header -->
  <div class="gradient-header text-white flex justify-between items-center p-4 shadow-2xl relative z-10">
    <div class="flex items-center space-x-2 sm:space-x-4">
      <div class="logo-container w-12 h-12 rounded-full flex items-center justify-center overflow-hidden bg-white/20 backdrop-blur-sm">
        <svg width="28" height="28" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" fill="#FF0000" rx="4"/>
          <rect x="6" y="13" width="20" height="6" fill="#FFF" rx="1"/>
          <rect x="13" y="6" width="6" height="20" fill="#FFF" rx="1"/>
        </svg>
      </div>
      <div class="min-w-0 flex-1">
        <span class="font-bold text-base sm:text-lg">Helvetic AI</span>
        <div class="flex items-center text-xs sm:text-sm opacity-90">
          <div class="connection-status">
            <div class="status-dot" id="connection-dot"></div>
            <span id="status-indicator">En ligne</span>
          </div>
          <div class="sentiment-indicator sentiment-positive ml-2" id="sentiment-indicator"></div>
        </div>
      </div>
    </div>
    <div class="flex items-center space-x-2 sm:space-x-3">
      <!-- Stats Button -->
      <button onclick="toggleStats()" class="relative px-3 py-1 bg-white/20 rounded text-sm hover:bg-white/30 transition">
        <i class="fas fa-chart-line mr-1"></i> Stats
        <div class="conversation-stats" id="conversation-stats">
          <h4 class="font-bold text-gray-800 mb-2">Statistiques</h4>
          <div class="text-sm text-gray-600">
            <div>Messages: <span id="message-count">0</span></div>
            <div>Satisfaction: <span id="avg-rating">N/A</span>/5</div>
            <div>Temps de r√©ponse: <span id="avg-response-time">0.8s</span></div>
            <div>Pr√©cision IA: <span id="ai-accuracy">94%</span></div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: 94%"></div>
            </div>
          </div>
        </div>
      </button>
      
      <!-- Export Dropdown -->
      <div class="dropdown" id="exportDropdown">
        <button onclick="toggleDropdown()" class="px-3 py-1 bg-white/20 rounded text-sm hover:bg-white/30 transition">
          <i class="fas fa-download mr-1"></i> Exporter
        </button>
        <div class="dropdown-content">
          <button onclick="exportConversation('txt')">
            <i class="fas fa-file-text mr-2"></i> Exporter en TXT
          </button>
          <button onclick="exportConversation('json')">
            <i class="fas fa-file-code mr-2"></i> Exporter en JSON
          </button>
          <button onclick="exportConversation('pdf')">
            <i class="fas fa-file-pdf mr-2"></i> Exporter en PDF
          </button>
          <button onclick="exportConversation('docx')">
            <i class="fas fa-file-word mr-2"></i> Exporter en DOCX
          </button>
        </div>
      </div>
      
      <!-- Theme Toggle -->
      <button onclick="toggleTheme()" class="px-3 py-1 bg-white/20 rounded text-sm hover:bg-white/30 transition" id="theme-toggle">
        <i class="fas fa-moon"></i>
      </button>
      
      <!-- Language Select -->
      <select id="lang-select" class="text-gray-800 rounded-lg px-3 py-2 text-xs sm:text-sm font-medium appearance-none pr-6 sm:pr-8 focus:outline-none focus:ring-2 focus:ring-white/50 bg-white/90">
        <option value="fr">üá´üá∑ FR</option>
        <option value="en">üá¨üáß EN</option>
        <option value="de">üá©üá™ DE</option>
      </select>
      
      <button onclick="parent.closeChatbot && parent.closeChatbot()" class="w-8 h-8 rounded-full flex items-center justify-center text-lg font-bold hover:bg-white/20 transition-colors">√ó</button>
    </div>
  </div>
  
  <!-- Messages Area -->
  <div id="chatbot-messages" class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-3 sm:space-y-4 chat-background">
    <!-- Messages will be inserted here -->
  </div>
  
  <!-- Quick Actions -->
  <div class="bg-white/80 backdrop-blur-sm px-4 py-2">
    <!-- Search Bar -->
    <div class="mb-3">
      <div class="relative">
        <input 
          type="text" 
          id="search-input" 
          placeholder="Rechercher par mot-cl√© (ex: prix, s√©curit√©, formation...)"
          class="w-full px-4 py-2 pl-10 pr-20 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white/90"
          oninput="performSearch(this.value)"
          onkeypress="handleSearchKeyPress(event)"
        >
        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        
        <!-- Smart Compose Button -->
        <button id="smart-compose-btn" class="smart-compose" onclick="showSmartCompose()" title="Assistance IA pour composer votre message">
          <i class="fas fa-magic mr-1"></i>IA
        </button>
        
        <!-- Advanced Search -->
        <button class="advanced-search" onclick="toggleAdvancedSearch()" title="Recherche avanc√©e">
          <i class="fas fa-sliders-h"></i>
        </button>
        
        <div id="search-results" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 mt-1 hidden max-h-60 overflow-y-auto">
          <!-- Search results will appear here -->
        </div>
      </div>
    </div>
    
    <div class="quick-actions" id="quick-actions">
      <button class="quick-action" onclick="handleQuickAction('demo')">
        <i class="fas fa-play mr-1"></i> D√©mo
      </button>
      <button class="quick-action" onclick="handleQuickAction('contact')">
        <i class="fas fa-envelope mr-1"></i> Contact
      </button>
      <button class="quick-action" onclick="handleQuickAction('pricing')">
        <i class="fas fa-tag mr-1"></i> Tarifs
      </button>
      <button class="quick-action" onclick="showAIInsights()">
        <i class="fas fa-brain mr-1"></i> Insights IA
      </button>
    </div>
  </div>
  
  <!-- Quick Questions -->
  <div class="border-t border-gray-200 bg-white/80 backdrop-blur-sm p-4 sm:p-6">
    <div class="text-xs sm:text-sm font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center justify-between" id="questions-title">
      <span>
        <i class="fas fa-question-circle w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-indigo-500"></i>
        Questions intelligentes :
      </span>
      <button onclick="refreshQuestions()" class="text-indigo-500 hover:text-indigo-700 transition" title="Actualiser les suggestions">
        <i class="fas fa-sync-alt"></i>
      </button>
    </div>
    <div id="questions-container" class="space-y-2 sm:space-y-3"></div>
    
    <!-- Smart Suggestions -->
    <div id="smart-suggestions" class="mt-4 hidden">
      <div class="text-xs font-semibold text-gray-700 mb-2">
        <i class="fas fa-lightbulb mr-1 text-yellow-500"></i>
        Suggestions bas√©es sur votre conversation :
      </div>
      <div id="suggestions-container"></div>
    </div>
  </div>
  
  <!-- Input Area -->
  <div class="bg-white p-4 border-t border-gray-200">
    <!-- AI Thinking Indicator -->
    <div id="ai-thinking" class="ai-thinking hidden">
      <div class="loading-spinner"></div>
      <span>L'IA analyse votre demande...</span>
    </div>
    
    <!-- File Preview -->
    <div id="file-preview" class="mb-3 hidden">
      <div class="flex items-center p-2 bg-gray-50 rounded-lg">
        <img id="preview-image" class="attachment-preview mr-3 hidden">
        <div id="preview-text" class="flex-1 text-sm text-gray-600"></div>
        <button onclick="clearFilePreview()" class="text-red-500 hover:text-red-700 transition">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    
    <div class="input-container">
      <div class="flex items-start p-2">
        <!-- Attachment Button -->
        <button onclick="document.getElementById('file-input').click()" class="p-2 text-gray-500 hover:text-indigo-600 transition-colors flex-shrink-0" title="Joindre un fichier">
          <i class="fas fa-paperclip"></i>
        </button>
        <input type="file" id="file-input" class="hidden" accept="image/*,.pdf,.doc,.docx,.txt,.csv,.xlsx" onchange="handleFileUpload(event)">
        
        <!-- Text Input Wrapper with Scrollbar -->
        <div class="text-input-wrapper flex-1">
          <textarea id="user-input" 
                    placeholder="Posez votre question..." 
                    class="w-full p-2 border-none outline-none text-sm bg-transparent resize-none min-h-[40px] leading-5"
                    rows="1"
                    style="overflow-y: hidden;"
                    oninput="autoResize(this); checkSmartCompose(this.value)"
                    onkeydown="handleKeyPress(event)"
                    onfocus="showInputSuggestions()"
                    onblur="hideInputSuggestions()"></textarea>
        </div>
        
        <div class="flex items-center flex-shrink-0">
          <!-- Voice Button -->
          <button onclick="toggleVoiceRecording()" class="voice-btn p-2 text-gray-500 hover:text-red-500 transition-all rounded-full mr-2" id="voice-btn" title="Enregistrement vocal">
            <i class="fas fa-microphone"></i>
          </button>
          
          <!-- Send Button -->
          <button onclick="handleUserInput()" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all font-medium disabled:opacity-50" id="send-btn">
            <i class="fas fa-paper-plane mr-1"></i> 
            <span id="send-text">Envoyer</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Input Suggestions -->
    <div id="input-suggestions" class="mt-2 hidden">
      <div class="flex flex-wrap gap-2">
        <!-- Dynamic suggestions will be added here -->
      </div>
    </div>
  </div>
</div>

<!-- Advanced Search Modal -->
<div id="advanced-search-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
  <div class="bg-white rounded-lg p-6 m-4 max-w-md w-full">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">Recherche Avanc√©e</h3>
      <button onclick="closeAdvancedSearch()" class="text-gray-500 hover:text-gray-700">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Cat√©gorie</label>
        <select id="search-category" class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="">Toutes les cat√©gories</option>
          <option value="pricing">Tarification</option>
          <option value="security">S√©curit√©</option>
          <option value="features">Fonctionnalit√©s</option>
          <option value="support">Support</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
        <select id="search-date" class="w-full border border-gray-300 rounded px-3 py-2">
          <option value="">Toute p√©riode</option>
          <option value="today">Aujourd'hui</option>
          <option value="week">Cette semaine</option>
          <option value="month">Ce mois</option>
        </select>
      </div>
      <div class="flex space-x-3">
        <button onclick="performAdvancedSearch()" class="flex-1 bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 transition">
          Rechercher
        </button>
        <button onclick="closeAdvancedSearch()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400 transition">
          Annuler
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Enhanced Helvetic AI Chatbot - Advanced Implementation

// ============== CORE CONFIGURATION ==============
const CONFIG = {
  maxMessageLength: 2000,
  maxFileSize: 10 * 1024 * 1024, // 10MB
  autoSaveInterval: 30000, // 30 seconds
  typingDelay: { min: 800, max: 2000 },
  maxConversationHistory: 500,
  aiConfidenceThreshold: 0.7,
  enableAnalytics: true,
  enableVoiceRecognition: 'webkitSpeechRecognition' in window
};

// ============== ENHANCED DATA STRUCTURES ==============
const quickQuestions = {
  fr: [
    "Qu'est-ce que l'IA en finance ?",
    "Quels sont vos services ?", 
    "Quels sont les avantages de l'EPM ?",
    "Combien co√ªte une impl√©mentation IA ?",
    "Comment garantissez-vous la s√©curit√© ?",
    "Puis-je demander une d√©mo ?",
    "Quelles sont vos r√©f√©rences clients ?",
    "Combien de temps dure l'impl√©mentation ?",
    "Proposez-vous de la formation ?",
    "Quels sont vos partenariats ?",
    "Comment mesurer le ROI ?",
    "Quelles sont les pr√©requis techniques ?",
    "G√©rez-vous la migration des donn√©es ?",
    "Quel niveau de personnalisation offrez-vous ?",
    "Comment assurer la conformit√© r√©glementaire ?"
  ],
  en: [
    "What is AI in finance?",
    "What services do you offer?",
    "What are the benefits of EPM?", 
    "How much does AI implementation cost?",
    "How do you ensure data security?",
    "Can I request a demo?",
    "What are your client references?",
    "How long does implementation take?",
    "Do you provide training?",
    "What are your partnerships?",
    "How to measure ROI?",
    "What are the technical prerequisites?",
    "Do you handle data migration?",
    "What level of customization do you offer?",
    "How to ensure regulatory compliance?"
  ],
  de: [
    "Was ist KI im Finanzwesen?",
    "Welche Dienstleistungen bieten Sie an?",
    "Was sind die Vorteile von EPM?",
    "Wie viel kostet eine KI-Implementierung?",
    "Wie garantieren Sie Datensicherheit?",
    "Kann ich eine Demo anfordern?",
    "Was sind Ihre Kundenreferenzen?",
    "Wie lange dauert die Implementierung?",
    "Bieten Sie Schulungen an?",
    "Was sind Ihre Partnerschaften?",
    "Wie misst man den ROI?",
    "Was sind die technischen Voraussetzungen?",
    "√úbernehmen Sie die Datenmigration?",
    "Welchen Grad der Anpassung bieten Sie?",
    "Wie gew√§hrleisten Sie die Einhaltung von Vorschriften?"
  ]
};

const translations = {
  fr: {
    welcome: `‚ú® Helvetic AI ‚Äî L'intelligence artificielle au service de la performance financi√®re ‚ú®

Helvetic AI accompagne les directions financi√®res dans leur transformation digitale.
Notre ambition : mettre la puissance de l'intelligence artificielle et de l'Enterprise Performance Management (EPM) au service des d√©cideurs, pour transformer la donn√©e en v√©ritable levier strat√©gique.

üîπ Une expertise unique : rigueur suisse + approche pragmatique et orient√©e r√©sultats.
üîπ Des solutions concr√®tes : automatisation des processus, analyse pr√©dictive, optimisation budg√©taire, pilotage de la performance.
üîπ Un engagement fort : fiabilit√© op√©rationnelle, innovation ma√Ætris√©e, conformit√© r√©glementaire.

üëâ Avec Helvetic AI, la performance financi√®re devient plus intelligente, plus rapide et plus s√ªre.`,
    online: "En ligne",
    readMore: "Lire plus",
    readLess: "Lire moins",
    typing: "En train d'√©crire...",
    rateResponse: "√âvaluez cette r√©ponse :",
    thinking: "L'IA r√©fl√©chit...",
    analyzing: "Analyse en cours...",
    processing: "Traitement..."
  },
  en: {
    welcome: `‚ú® Helvetic AI ‚Äî Artificial Intelligence at the service of financial performance ‚ú®

Helvetic AI supports CFOs in their digital transformation, turning data into a real strategic lever through AI and EPM.

üîπ Unique expertise: Swiss precision combined with pragmatic, results-oriented methods.
üîπ Concrete solutions: automation, predictive analysis, budgeting optimization, performance management.
üîπ Strong commitment: operational reliability, controlled innovation, full compliance.

üëâ With Helvetic AI, financial performance becomes smarter, faster and safer.`,
    online: "Online",
    readMore: "Read more", 
    readLess: "Read less",
    typing: "Typing...",
    rateResponse: "Rate this response:",
    thinking: "AI is thinking...",
    analyzing: "Analyzing...",
    processing: "Processing..."
  },
  de: {
    welcome: `‚ú® Helvetic AI ‚Äî K√ºnstliche Intelligenz im Dienste der Finanzperformance ‚ú®

Helvetic AI begleitet Finanzdirektionen bei der digitalen Transformation und macht Daten dank KI und EPM zu einem echten strategischen Hebel.

üîπ Einzigartige Expertise: Schweizer Pr√§zision + pragmatische, ergebnisorientierte Ans√§tze.
üîπ Konkrete L√∂sungen: Automatisierung, pr√§diktive Analysen, Budgetoptimierung, Performance-Steuerung.
üîπ Starkes Engagement: operative Zuverl√§ssigkeit, kontrollierte Innovation, volle Compliance.

üëâ Mit Helvetic AI wird die Finanzperformance intelligenter, schneller und sicherer.`,
    online: "Online",
    readMore: "Mehr lesen",
    readLess: "Weniger lesen",
    typing: "Schreibt...",
    rateResponse: "Bewerten Sie diese Antwort:",
    thinking: "KI denkt nach...",
    analyzing: "Analysiert...",
    processing: "Verarbeitung..."
  }
};

// ============== ENHANCED RESPONSE DATABASE ==============
const enhancedResponses = {
  fr: {
    "Qu'est-ce que l'IA en finance ?": {
      text: "L'IA en finance r√©volutionne la gestion financi√®re en automatisant les t√¢ches r√©p√©titives, en am√©liorant la pr√©cision des pr√©visions gr√¢ce √† l'analyse pr√©dictive, et en permettant une prise de d√©cision bas√©e sur des donn√©es en temps r√©el. Nos solutions incluent la d√©tection de fraudes, l'optimisation des investissements, et l'automatisation du reporting financier.",
      confidence: 0.95,
      category: "features",
      keywords: ["IA", "intelligence artificielle", "finance", "automatisation"],
      relatedQuestions: ["Quels sont vos services ?", "Quels sont les avantages de l'EPM ?"]
    },
    "Comment mesurer le ROI ?": {
      text: "Le ROI de nos solutions se mesure sur plusieurs dimensions :\n‚Ä¢ R√©duction des co√ªts op√©rationnels (40-60%)\n‚Ä¢ Acc√©l√©ration des processus (jusqu'√† 80% plus rapide)\n‚Ä¢ Am√©lioration de la pr√©cision (99.5%)\n‚Ä¢ R√©duction des erreurs humaines (90%)\n‚Ä¢ Gains de productivit√© (3-5h/jour/utilisateur)\n\nNous fournissons un dashboard ROI en temps r√©el avec m√©triques personnalis√©es.",
      confidence: 0.92,
      category: "pricing",
      keywords: ["ROI", "retour investissement", "co√ªts", "√©conomies"]
    }
    // ... More enhanced responses
  },
  en: {
    "What is AI in finance?": {
      text: "AI in finance transforms financial management by automating repetitive tasks, improving forecast accuracy through predictive analytics, and enabling real-time data-driven decision making. Our solutions include fraud detection, investment optimization, and automated financial reporting.",
      confidence: 0.95,
      category: "features",
      keywords: ["AI", "artificial intelligence", "finance", "automation"],
      relatedQuestions: ["What services do you offer?", "What are the benefits of EPM?"]
    }
    // ... More enhanced responses
  },
  de: {
    "Was ist KI im Finanzwesen?": {
      text: "KI im Finanzwesen transformiert das Finanzmanagement durch Automatisierung repetitiver Aufgaben, Verbesserung der Prognosegenauigkeit durch pr√§diktive Analysen und erm√∂glicht datenbasierte Entscheidungen in Echtzeit. Unsere L√∂sungen umfassen Betrugserkennung, Investitionsoptimierung und automatisierte Finanzberichterstattung.",
      confidence: 0.95,
      category: "features",
      keywords: ["KI", "k√ºnstliche Intelligenz", "Finanzwesen", "Automatisierung"],
      relatedQuestions: ["Welche Dienstleistungen bieten Sie an?", "Was sind die Vorteile von EPM?"]
    }
    // ... More enhanced responses
  }
};

// ============== GLOBAL STATE MANAGEMENT ==============
class ChatbotState {
  constructor() {
    this.currentLang = "fr";
    this.conversationHistory = [];
    this.isRecording = false;
    this.isDarkTheme = false;
    this.messageCount = 0;
    this.ratings = [];
    this.currentFile = null;
    this.searchTimeout = null;
    this.aiThinking = false;
    this.lastUserInput = "";
    this.conversationContext = {};
    this.userPreferences = {};
    this.connectionStatus = "online";
    this.autoSaveTimer = null;
    this.speechRecognition = null;
    this.smartComposerActive = false;
  }

  // State persistence
  save() {
    const state = {
      conversationHistory: this.conversationHistory,
      currentLang: this.currentLang,
      isDarkTheme: this.isDarkTheme,
      userPreferences: this.userPreferences,
      messageCount: this.messageCount,
      ratings: this.ratings
    };
    
    try {
      sessionStorage.setItem('helvetic-ai-chatbot-state', JSON.stringify(state));
    } catch (e) {
      console.warn('Failed to save state:', e);
    }
  }

  load() {
    try {
      const saved = sessionStorage.getItem('helvetic-ai-chatbot-state');
      if (saved) {
        const state = JSON.parse(saved);
        Object.assign(this, state);
        return true;
      }
    } catch (e) {
      console.warn('Failed to load state:', e);
    }
    return false;
  }

  reset() {
    this.conversationHistory = [];
    this.messageCount = 0;
    this.ratings = [];
    this.conversationContext = {};
    this.save();
  }
}

// ============== INITIALIZE STATE ==============
const chatState = new ChatbotState();

// ============== ENHANCED AI ENGINE ==============
class AIEngine {
  constructor() {
    this.contextWindow = [];
    this.learningData = {};
    this.confidenceScores = new Map();
  }

  analyzeQuery(query, context = {}) {
    const analysis = {
      intent: this.extractIntent(query),
      entities: this.extractEntities(query),
      sentiment: this.analyzeSentiment(query),
      complexity: this.assessComplexity(query),
      confidence: 0.8
    };

    return analysis;
  }

  extractIntent(query) {
    const intents = {
      question: ['quoi', 'comment', 'pourquoi', 'qui', 'quand', 'o√π', 'what', 'how', 'why', 'who', 'when', 'where'],
      request: ['peux-tu', 'pouvez-vous', 'j\'aimerais', 'can you', 'could you', 'i would like'],
      complaint: ['probl√®me', 'erreur', 'bug', 'ne fonctionne pas', 'problem', 'error', 'doesn\'t work'],
      praise: ['excellent', 'parfait', 'super', 'merci', 'excellent', 'perfect', 'great', 'thank you']
    };

    const lowerQuery = query.toLowerCase();
    
    for (const [intent, keywords] of Object.entries(intents)) {
      if (keywords.some(keyword => lowerQuery.includes(keyword))) {
        return intent;
      }
    }
    
    return 'unknown';
  }

  extractEntities(query) {
    const entities = {
      price: ['prix', 'co√ªt', 'tarif', 'cost', 'price', 'preis', 'kosten'],
      security: ['s√©curit√©', 'protection', 'confidentialit√©', 'security', 'privacy', 'sicherheit'],
      time: ['temps', 'dur√©e', 'd√©lai', 'time', 'duration', 'zeit', 'dauer'],
      demo: ['d√©mo', 'd√©monstration', 'essai', 'demo', 'demonstration', 'trial']
    };

    const found = [];
    const lowerQuery = query.toLowerCase();

    for (const [entity, keywords] of Object.entries(entities)) {
      if (keywords.some(keyword => lowerQuery.includes(keyword))) {
        found.push(entity);
      }
    }

    return found;
  }

  analyzeSentiment(text) {
    const positiveWords = ['excellent', 'parfait', 'super', 'g√©nial', 'fantastique', 'merci', 'bien', 'bon'];
    const negativeWords = ['probl√®me', 'erreur', 'mauvais', 'd√©faut', 'bug', 'lent', 'difficile'];
    
    const words = text.toLowerCase().split(' ');
    let score = 0;
    
    words.forEach(word => {
      if (positiveWords.includes(word)) score += 1;
      if (negativeWords.includes(word)) score -= 1;
    });
    
    if (score > 0) return 'positive';
    if (score < 0) return 'negative';
    return 'neutral';
  }

  assessComplexity(query) {
    const wordCount = query.split(' ').length;
    const hasSpecialChars = /[?!.,;:]/.test(query);
    const hasNumbers = /\d/.test(query);
    
    let complexity = 0;
    if (wordCount > 10) complexity += 1;
    if (hasSpecialChars) complexity += 0.5;
    if (hasNumbers) complexity += 0.5;
    
    if (complexity < 1) return 'simple';
    if (complexity < 2) return 'medium';
    return 'complex';
  }

  generateResponse(query, analysis) {
    // Check for exact matches first
    const exactResponse = enhancedResponses[chatState.currentLang][query];
    if (exactResponse) {
      return {
        text: exactResponse.text,
        confidence: exactResponse.confidence || 0.9,
        relatedQuestions: exactResponse.relatedQuestions || []
      };
    }

    // Use fuzzy matching
    const fuzzyResponse = this.findSimilarResponse(query);
    if (fuzzyResponse) {
      return fuzzyResponse;
    }

    // Generate contextual response
    return this.generateContextualResponse(query, analysis);
  }

  findSimilarResponse(query) {
    const responses = enhancedResponses[chatState.currentLang];
    let bestMatch = null;
    let bestScore = 0;

    for (const [question, response] of Object.entries(responses)) {
      const similarity = this.calculateSimilarity(query, question);
      if (similarity > bestScore && similarity > 0.6) {
        bestScore = similarity;
        bestMatch = {
          text: response.text,
          confidence: similarity * 0.8,
          relatedQuestions: response.relatedQuestions || []
        };
      }
    }

    return bestMatch;
  }

  calculateSimilarity(str1, str2) {
    const words1 = str1.toLowerCase().split(' ');
    const words2 = str2.toLowerCase().split(' ');
    
    let matches = 0;
    words1.forEach(word => {
      if (words2.includes(word) && word.length > 2) {
        matches++;
      }
    });

    return matches / Math.max(words1.length, words2.length);
  }

  generateContextualResponse(query, analysis) {
    const templates = {
      fr: {
        question: "C'est une excellente question ! Je vais vous aider avec des informations sur {topic}. Souhaitez-vous que je vous propose une d√©monstration personnalis√©e ?",
        request: "Je comprends votre demande concernant {topic}. Laissez-moi vous mettre en contact avec notre √©quipe sp√©cialis√©e.",
        complaint: "Je vous remercie de nous faire part de cette pr√©occupation. Notre √©quipe technique va examiner cela imm√©diatement.",
        unknown: "Merci pour votre message. Pour vous donner la r√©ponse la plus pr√©cise, puis-je vous proposer un √©change avec l'un de nos experts ?"
      }
    };

    const template = templates[chatState.currentLang][analysis.intent] || templates[chatState.currentLang].unknown;
    const topic = analysis.entities.join(', ') || 'votre demande';
    
    return {
      text: template.replace('{topic}', topic),
      confidence: 0.6,
      relatedQuestions: this.suggestRelatedQuestions(analysis.entities)
    };
  }

  suggestRelatedQuestions(entities) {
    const suggestions = [];
    const questions = quickQuestions[chatState.currentLang];
    
    entities.forEach(entity => {
      const related = questions.filter(q => 
        q.toLowerCase().includes(entity) || 
        this.isRelatedTopic(entity, q)
      );
      suggestions.push(...related.slice(0, 2));
    });

    return [...new Set(suggestions)].slice(0, 3);
  }

  isRelatedTopic(entity, question) {
    const relations = {
      price: ['tarif', 'co√ªt', 'budget'],
      security: ['protection', 'confidentialit√©', 's√©curit√©'],
      time: ['dur√©e', 'd√©lai', 'temps'],
      demo: ['d√©monstration', 'essai', 'test']
    };

    const relatedTerms = relations[entity] || [];
    return relatedTerms.some(term => question.toLowerCase().includes(term));
  }
}

// ============== INITIALIZE AI ENGINE ==============
const aiEngine = new AIEngine();

// ============== ENHANCED MESSAGE HANDLING ==============
class MessageHandler {
  static async addMessage(text, sender = "bot", options = {}) {
    const {
      isWelcome = false,
      showActions = true,
      confidence = null,
      relatedQuestions = [],
      isError = false,
      isSuccess = false
    } = options;

    const container = document.createElement("div");
    container.className = `message-container ${sender === "user" ? "text-right" : "text-left"}`;
    
    const bubble = document.createElement("div");
    let bubbleClass = sender === "user" ? 
      "inline-block px-4 py-3 rounded-2xl max-w-xs lg:max-w-md text-sm font-medium message-bubble-user bg-gradient-to-r from-indigo-600 to-purple-600 text-white" :
      "inline-block px-4 py-3 rounded-2xl max-w-xs lg:max-w-md text-sm font-medium message-bubble-bot bg-white/90 backdrop-blur-sm whitespace-pre-line";

    if (isError) {
      bubbleClass += " border-l-4 border-red-500 bg-red-50";
    } else if (isSuccess) {
      bubbleClass += " border-l-4 border-green-500 bg-green-50";
    }

    bubble.className = bubbleClass;

    // Handle welcome message with read more/less
    if (isWelcome) {
      bubble.innerHTML = `
        <div id="welcome-preview" class="line-clamp-5">${text}</div>
        <button id="toggleWelcome" class="mt-2 text-indigo-600 text-xs underline">${translations[chatState.currentLang].readMore}</button>
      `;
      setTimeout(() => this.setupWelcomeToggle(), 50);
    } else {
      bubble.innerHTML = text;
    }

    container.appendChild(bubble);

    // Add confidence indicator for AI responses
    if (sender === "bot" && confidence !== null && !isWelcome) {
      const confidenceDiv = document.createElement("div");
      confidenceDiv.className = "confidence-indicator mt-2";
      confidenceDiv.innerHTML = `
        <div class="confidence-fill ${this.getConfidenceClass(confidence)}" style="width: ${confidence * 100}%"></div>
      `;
      container.appendChild(confidenceDiv);
    }

    // Add timestamp
    const timestamp = document.createElement("div");
    timestamp.className = "message-timestamp";
    timestamp.textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    container.appendChild(timestamp);

    // Add message actions for bot messages
    if (sender === "bot" && showActions && !isWelcome) {
      const actions = this.createMessageActions(text, relatedQuestions);
      container.appendChild(actions);
    }

    document.getElementById("chatbot-messages").appendChild(container);
    this.scrollToBottom();

    // Update conversation history
    chatState.conversationHistory.push({
      sender: sender,
      text: text,
      time: new Date().toISOString(),
      sentiment: sender === "user" ? aiEngine.analyzeSentiment(text) : "neutral",
      confidence: confidence
    });

    chatState.messageCount++;
    this.updateStats();

    // Update sentiment indicator for user messages
    if (sender === "user") {
      this.updateSentimentIndicator(aiEngine.analyzeSentiment(text));
    }

    // Auto-save state
    chatState.save();

    // Show smart suggestions after bot response
    if (sender === "bot" && relatedQuestions.length > 0) {
      setTimeout(() => this.showSmartSuggestions(relatedQuestions), 1000);
    }
  }

  static setupWelcomeToggle() {
    const toggleBtn = document.getElementById("toggleWelcome");
    const preview = document.getElementById("welcome-preview");
    if (toggleBtn && preview) {
      toggleBtn.addEventListener("click", () => {
        if (toggleBtn.textContent === translations[chatState.currentLang].readMore) {
          preview.classList.remove("line-clamp-5");
          toggleBtn.textContent = translations[chatState.currentLang].readLess;
        } else {
          preview.classList.add("line-clamp-5");
          toggleBtn.textContent = translations[chatState.currentLang].readMore;
        }
      });
    }
  }

  static getConfidenceClass(confidence) {
    if (confidence >= 0.8) return 'confidence-high';
    if (confidence >= 0.6) return 'confidence-medium';
    return 'confidence-low';
  }

  static createMessageActions(text, relatedQuestions) {
    const actions = document.createElement("div");
    actions.className = "message-actions";
    actions.innerHTML = `
      <button class="action-btn" onclick="MessageHandler.copyMessage('${text.replace(/'/g, "\\'")}')">
        <i class="fas fa-copy mr-1"></i> Copier
      </button>
      <button class="action-btn" onclick="MessageHandler.shareMessage('${text.replace(/'/g, "\\'")}')">
        <i class="fas fa-share mr-1"></i> Partager
      </button>
      <button class="action-btn" onclick="MessageHandler.translateMessage('${text.replace(/'/g, "\\'")}')">
        <i class="fas fa-language mr-1"></i> Traduire
      </button>
    `;

    // Add rating system
    const ratingDiv = document.createElement("div");
    ratingDiv.innerHTML = `
      <div class="text-xs text-gray-500 mt-2">${translations[chatState.currentLang].rateResponse}</div>
      <div class="satisfaction-rating">
        ${[1,2,3,4,5].map(i => `<span class="rating-star" onclick="MessageHandler.rateMessage(${i}, this)">‚≠ê</span>`).join('')}
      </div>
    `;
    actions.appendChild(ratingDiv);

    return actions;
  }

  static scrollToBottom() {
    const messagesContainer = document.getElementById("chatbot-messages");
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  static updateSentimentIndicator(sentiment) {
    const indicator = document.getElementById('sentiment-indicator');
    indicator.className = `sentiment-indicator sentiment-${sentiment}`;
  }

  static updateStats() {
    document.getElementById("message-count").textContent = chatState.messageCount;
    
    if (chatState.ratings.length > 0) {
      const avgRating = chatState.ratings.reduce((a, b) => a + b, 0) / chatState.ratings.length;
      document.getElementById("avg-rating").textContent = avgRating.toFixed(1);
    }
  }

  static showSmartSuggestions(questions) {
    const container = document.getElementById("suggestions-container");
    const wrapper = document.getElementById("smart-suggestions");
    
    if (questions.length === 0) {
      wrapper.classList.add("hidden");
      return;
    }

    container.innerHTML = questions.map(question => `
      <div class="smart-suggestion" onclick="MessageHandler.selectSuggestion('${question.replace(/'/g, "\\'")}')">
        <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
        ${question}
      </div>
    `).join('');

    wrapper.classList.remove("hidden");
  }

  static selectSuggestion(question) {
    document.getElementById("smart-suggestions").classList.add("hidden");
    InputHandler.sendMessage(question);
  }

  // Message actions
  static copyMessage(text) {
    navigator.clipboard.writeText(text).then(() => {
      NotificationManager.show("Message copi√© !", "success");
    }).catch(() => {
      NotificationManager.show("Erreur lors de la copie", "error");
    });
  }

  static shareMessage(text) {
    if (navigator.share) {
      navigator.share({
        title: 'Helvetic AI',
        text: text
      });
    } else {
      this.copyMessage(text);
      NotificationManager.show("Message copi√© pour partage !", "info");
    }
  }

  static translateMessage(text) {
    // Simulate translation (in a real app, use translation API)
    const targetLang = chatState.currentLang === 'fr' ? 'en' : 'fr';
    NotificationManager.show(`Traduction vers ${targetLang.toUpperCase()} simul√©e`, "info");
  }

  static rateMessage(rating, element) {
    // Update visual feedback
    const stars = element.parentNode.querySelectorAll('.rating-star');
    stars.forEach((star, index) => {
      if (index < rating) {
        star.classList.add('active');
      } else {
        star.classList.remove('active');
      }
    });
    
    chatState.ratings.push(rating);
    this.updateStats();
    NotificationManager.show("Merci pour votre √©valuation !", "success");
  }
}

// ============== ENHANCED INPUT HANDLING ==============
class InputHandler {
  static async handleUserInput() {
    const input = document.getElementById("user-input");
    const text = input.value.trim();
    
    if (!text && !chatState.currentFile) {
      NotificationManager.show("Veuillez saisir un message", "warning");
      return;
    }

    if (text.length > CONFIG.maxMessageLength) {
      NotificationManager.show(`Message trop long (max ${CONFIG.maxMessageLength} caract√®res)`, "error");
      return;
    }

    // Disable send button
    const sendBtn = document.getElementById("send-btn");
    sendBtn.disabled = true;
    sendBtn.innerHTML = '<div class="loading-spinner"></div> Envoi...';

    try {
      await this.sendMessage(text);
    } finally {
      // Re-enable send button
      sendBtn.disabled = false;
      sendBtn.innerHTML = '<i class="fas fa-paper-plane mr-1"></i> <span id="send-text">Envoyer</span>';
    }
  }

  static async sendMessage(text) {
    // Add user message
    await MessageHandler.addMessage(text, "user");
    
    // Clear input
    const input = document.getElementById("user-input");
    input.value = "";
    this.autoResize(input);
    
    // Clear file if any
    FileHandler.clearFilePreview();
    
    // Show AI thinking
    this.showAIThinking();
    
    try {
      // Analyze the query
      const analysis = aiEngine.analyzeQuery(text, chatState.conversationContext);
      
      // Update context
      chatState.conversationContext.lastQuery = text;
      chatState.conversationContext.lastIntent = analysis.intent;
      
      // Generate response
      const response = aiEngine.generateResponse(text, analysis);
      
      // Simulate realistic response time
      const responseTime = CONFIG.typingDelay.min + 
        Math.random() * (CONFIG.typingDelay.max - CONFIG.typingDelay.min);
      
      await new Promise(resolve => setTimeout(resolve, responseTime));
      
      // Hide AI thinking
      this.hideAIThinking();
      
      // Add bot response
      await MessageHandler.addMessage(response.text, "bot", {
        confidence: response.confidence,
        relatedQuestions: response.relatedQuestions
      });
      
    } catch (error) {
      console.error('Error generating response:', error);
      this.hideAIThinking();
      
      await MessageHandler.addMessage(
        "D√©sol√©, une erreur s'est produite. Veuillez r√©essayer ou contacter notre support.", 
        "bot", 
        { isError: true }
      );
    }
  }

  static showAIThinking() {
    const indicator = document.getElementById("ai-thinking");
    indicator.classList.remove("hidden");
    chatState.aiThinking = true;
  }

  static hideAIThinking() {
    const indicator = document.getElementById("ai-thinking");
    indicator.classList.add("hidden");
    chatState.aiThinking = false;
  }

  static autoResize(textarea) {
    textarea.style.height = 'auto';
    const newHeight = Math.min(textarea.scrollHeight, 120);
    textarea.style.height = newHeight + 'px';
    
    if (textarea.scrollHeight > 120) {
      textarea.style.overflowY = 'auto';
    } else {
      textarea.style.overflowY = 'hidden';
    }
  }

  static handleKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      this.handleUserInput();
    }
  }

  static checkSmartCompose(value) {
    const smartComposeBtn = document.getElementById("smart-compose-btn");
    
    if (value.length > 10 && !chatState.smartComposerActive) {
      smartComposeBtn.classList.add("show");
    } else if (value.length <= 10) {
      smartComposeBtn.classList.remove("show");
    }
  }

  static showInputSuggestions() {
    const suggestions = this.getContextualSuggestions();
    const container = document.getElementById("input-suggestions");
    
    if (suggestions.length > 0) {
      container.innerHTML = `
        <div class="flex flex-wrap gap-2">
          ${suggestions.map(suggestion => `
            <button class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs hover:bg-indigo-200 transition" 
                    onclick="InputHandler.applySuggestion('${suggestion.replace(/'/g, "\\'")}')">
              ${suggestion}
            </button>
          `).join('')}
        </div>
      `;
      container.classList.remove("hidden");
    }
  }

  static hideInputSuggestions() {
    setTimeout(() => {
      document.getElementById("input-suggestions").classList.add("hidden");
    }, 200);
  }

  static getContextualSuggestions() {
    const context = chatState.conversationContext;
    const suggestions = [];

    if (context.lastIntent === 'question') {
      suggestions.push("Pouvez-vous d√©tailler ?", "Quel est le processus ?", "Quels sont les pr√©requis ?");
    } else if (context.lastIntent === 'request') {
      suggestions.push("Merci pour l'information", "J'aimerais en savoir plus", "Quand pouvons-nous commencer ?");
    } else {
      suggestions.push("Puis-je avoir une d√©monstration ?", "Quels sont vos tarifs ?", "Comment garantissez-vous la s√©curit√© ?");
    }

    return suggestions.slice(0, 3);
  }

  static applySuggestion(suggestion) {
    document.getElementById("user-input").value = suggestion;
    document.getElementById("input-suggestions").classList.add("hidden");
    this.autoResize(document.getElementById("user-input"));
  }
}

// ============== NOTIFICATION MANAGER ==============
class NotificationManager {
  static show(message, type = "info", description = "", duration = 3000) {
    const toast = document.getElementById("notification-toast");
    const icon = document.getElementById("toast-icon");
    const messageEl = document.getElementById("toast-message");
    const descriptionEl = document.getElementById("toast-description");

    // Set icon based on type
    const icons = {
      success: "fas fa-check-circle text-green-500",
      error: "fas fa-exclamation-circle text-red-500",
      warning: "fas fa-exclamation-triangle text-yellow-500",
      info: "fas fa-info-circle text-blue-500"
    };

    icon.className = icons[type] || icons.info;
    messageEl.textContent = message;
    descriptionEl.textContent = description;
    descriptionEl.style.display = description ? "block" : "none";

    toast.classList.remove("hidden");
    
    if (duration > 0) {
      setTimeout(() => this.hide(), duration);
    }
  }

  static hide() {
    document.getElementById("notification-toast").classList.add("hidden");
  }
}

// ============== FILE HANDLER ==============
class FileHandler {
  static handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    if (file.size > CONFIG.maxFileSize) {
      NotificationManager.show(
        "Fichier trop volumineux", 
        "error", 
        `Taille maximum autoris√©e: ${CONFIG.maxFileSize / 1024 / 1024}MB`
      );
      return;
    }

    chatState.currentFile = file;
    const preview = document.getElementById("file-preview");
    const previewText = document.getElementById("preview-text");
    const previewImage = document.getElementById("preview-image");
    
    preview.classList.remove("hidden");
    
    if (file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImage.src = e.target.result;
        previewImage.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
      previewText.textContent = `Image: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
    } else {
      previewImage.classList.add("hidden");
      previewText.textContent = `Document: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
    }

    NotificationManager.show("Fichier ajout√© avec succ√®s", "success");
  }

  static clearFilePreview() {
    document.getElementById("file-preview").classList.add("hidden");
    document.getElementById("file-input").value = "";
    chatState.currentFile = null;
  }
}

// ============== VOICE HANDLER ==============
class VoiceHandler {
  static toggleVoiceRecording() {
    if (!CONFIG.enableVoiceRecognition) {
      NotificationManager.show("Reconnaissance vocale non support√©e", "warning");
      return;
    }

    const btn = document.getElementById("voice-btn");
    
    if (!chatState.isRecording) {
      this.startRecording(btn);
    } else {
      this.stopRecording(btn);
    }
  }

  static startRecording(btn) {
    try {
      chatState.speechRecognition = new webkitSpeechRecognition();
      chatState.speechRecognition.continuous = false;
      chatState.speechRecognition.interimResults = false;
      chatState.speechRecognition.lang = chatState.currentLang === 'fr' ? 'fr-FR' : 
                                       chatState.currentLang === 'en' ? 'en-US' : 'de-DE';

      chatState.speechRecognition.onstart = () => {
        btn.classList.add("voice-recording");
        btn.innerHTML = '<i class="fas fa-stop"></i>';
        chatState.isRecording = true;
        NotificationManager.show("Enregistrement en cours...", "info");
      };

      chatState.speechRecognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("user-input").value = transcript;
        InputHandler.autoResize(document.getElementById("user-input"));
        NotificationManager.show("Texte reconnu avec succ√®s", "success");
      };

      chatState.speechRecognition.onerror = (event) => {
        NotificationManager.show("Erreur de reconnaissance vocale", "error");
        this.stopRecording(btn);
      };

      chatState.speechRecognition.onend = () => {
        this.stopRecording(btn);
      };

      chatState.speechRecognition.start();
    } catch (error) {
      NotificationManager.show("Erreur lors du d√©marrage de l'enregistrement", "error");
      console.error('Speech recognition error:', error);
    }
  }

  static stopRecording(btn) {
    if (chatState.speechRecognition) {
      chatState.speechRecognition.stop();
    }
    
    btn.classList.remove("voice-recording");
    btn.innerHTML = '<i class="fas fa-microphone"></i>';
    chatState.isRecording = false;
  }
}

// ============== SEARCH ENHANCEMENT ==============
class SearchHandler {
  static performSearch(query) {
    const searchResults = document.getElementById('search-results');
    
    if (chatState.searchTimeout) {
      clearTimeout(chatState.searchTimeout);
    }
    
    if (!query.trim()) {
      searchResults.classList.add('hidden');
      return;
    }
    
    chatState.searchTimeout = setTimeout(() => {
      const results = this.findRelevantQuestions(query.toLowerCase());
      this.displaySearchResults(results, query);
    }, 300);
  }

  static findRelevantQuestions(query) {
    const allQuestions = quickQuestions[chatState.currentLang];
    const allResponses = enhancedResponses[chatState.currentLang];
    const results = [];
    
    // Enhanced keyword matching
    allQuestions.forEach(question => {
      const similarity = aiEngine.calculateSimilarity(query, question);
      if (similarity > 0.3) {
        const response = allResponses[question];
        results.push({
          question: question,
          response: response ? response.text : "R√©ponse disponible sur demande",
          relevance: similarity,
          confidence: response ? response.confidence : 0.5,
          matchType: 'similarity'
        });
      }
    });
    
    return results.sort((a, b) => b.relevance - a.relevance).slice(0, 8);
  }

  static displaySearchResults(results, query) {
    const searchResults = document.getElementById('search-results');
    
    if (results.length === 0) {
      searchResults.innerHTML = `
        <div class="no-results">
          <i class="fas fa-search text-gray-300 mb-2"></i>
          <div>Aucun r√©sultat pour "${query}"</div>
          <div class="text-xs mt-1">Essayez: prix, s√©curit√©, formation, d√©mo</div>
        </div>
      `;
      searchResults.classList.remove('hidden');
      return;
    }
    
    const resultsHTML = results.map(result => {
      const preview = result.response.substring(0, 100) + (result.response.length > 100 ? '...' : '');
      const highlightedQuestion = this.highlightText(result.question, query);
      const highlightedPreview = this.highlightText(preview, query);
      const confidenceBar = result.confidence ? 
        `<div class="w-full h-1 bg-gray-200 rounded mt-1">
          <div class="h-1 bg-indigo-500 rounded" style="width: ${result.confidence * 100}%"></div>
        </div>` : '';
      
      return `
        <div class="search-result-item" onclick="SearchHandler.selectSearchResult('${result.question.replace(/'/g, "\\'")}')">
          <div class="search-result-question">${highlightedQuestion}</div>
          <div class="search-result-preview">${highlightedPreview}</div>
          ${confidenceBar}
        </div>
      `;
    }).join('');
    
    searchResults.innerHTML = resultsHTML;
    searchResults.classList.remove('hidden');
  }

  static highlightText(text, query) {
    if (!query) return text;
    
    const words = query.split(' ').filter(word => word.length > 2);
    let highlightedText = text;
    
    words.forEach(word => {
      const regex = new RegExp(`(${word})`, 'gi');
      highlightedText = highlightedText.replace(regex, '<span class="search-highlight">$1</span>');
    });
    
    return highlightedText;
  }

  static selectSearchResult(question) {
    document.getElementById('search-results').classList.add('hidden');
    document.getElementById('search-input').value = '';
    InputHandler.sendMessage(question);
  }

  static handleSearchKeyPress(event) {
    const searchResults = document.getElementById('search-results');
    
    if (event.key === 'Enter') {
      const firstResult = searchResults.querySelector('.search-result-item');
      if (firstResult) {
        firstResult.click();
      }
    } else if (event.key === 'Escape') {
      searchResults.classList.add('hidden');
      document.getElementById('search-input').value = '';
    }
  }
}

// ============== EXPORT FUNCTIONALITY ==============
class ExportHandler {
  static async exportConversation(format = "txt") {
    if (chatState.conversationHistory.length === 0) {
      NotificationManager.show("Aucune conversation √† exporter", "warning");
      return;
    }

    NotificationManager.show("G√©n√©ration de l'export...", "info");

    try {
      let content, blob, filename;
      
      switch (format) {
        case "json":
          content = JSON.stringify({
            conversation: chatState.conversationHistory,
            stats: {
              messageCount: chatState.messageCount,
              averageRating: chatState.ratings.length > 0 ? 
                chatState.ratings.reduce((a, b) => a + b, 0) / chatState.ratings.length : null,
              language: chatState.currentLang,
              userPreferences: chatState.userPreferences
            },
            exportDate: new Date().toISOString(),
            version: "1.0"
          }, null, 2);
          blob = new Blob([content], { type: "application/json" });
          filename = `helvetic-ai-conversation-${new Date().toISOString().split('T')[0]}.json`;
          break;

        case "docx":
          content = this.generateDocxContent();
          blob = new Blob([content], { type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document" });
          filename = `helvetic-ai-conversation-${new Date().toISOString().split('T')[0]}.docx`;
          break;

        case "pdf":
          content = this.generatePdfContent();
          blob = new Blob([content], { type: "application/pdf" });
          filename = `helvetic-ai-conversation-${new Date().toISOString().split('T')[0]}.pdf`;
          break;

        default: // txt
          content = this.generateTextContent();
          blob = new Blob([content], { type: "text/plain" });
          filename = `helvetic-ai-conversation-${new Date().toISOString().split('T')[0]}.txt`;
      }

      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
      
      document.getElementById("exportDropdown").classList.remove("show");
      NotificationManager.show(`Conversation export√©e en ${format.toUpperCase()} !`, "success");
      
    } catch (error) {
      console.error('Export error:', error);
      NotificationManager.show("Erreur lors de l'export", "error");
    }
  }

  static generateTextContent() {
    const header = `Helvetic AI - Export de Conversation
Date: ${new Date().toLocaleString()}
Langue: ${chatState.currentLang.toUpperCase()}
Messages: ${chatState.messageCount}
${chatState.ratings.length > 0 ? `Note moyenne: ${(chatState.ratings.reduce((a, b) => a + b, 0) / chatState.ratings.length).toFixed(1)}/5` : ''}

${'='.repeat(80)}

`;

    const messages = chatState.conversationHistory.map(msg => {
      const time = new Date(msg.time).toLocaleTimeString();
      const confidence = msg.confidence ? ` (confiance: ${(msg.confidence * 100).toFixed(0)}%)` : '';
      return `[${time}] ${msg.sender.toUpperCase()}${confidence}: ${msg.text}`;
    }).join('\n\n');

    return header + messages;
  }

  static generateDocxContent() {
    // Simplified DOCX content - in a real implementation, use a proper DOCX library
    return this.generateTextContent();
  }

  static generatePdfContent() {
    // Simplified PDF content - in a real implementation, use a proper PDF library
    return this.generateTextContent();
  }
}

// ============== THEME AND UI MANAGEMENT ==============
class ThemeManager {
  static toggleTheme() {
    chatState.isDarkTheme = !chatState.isDarkTheme;
    const body = document.body;
    const themeBtn = document.getElementById("theme-toggle");
    
    if (chatState.isDarkTheme) {
      body.classList.add("theme-dark");
      themeBtn.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
      body.classList.remove("theme-dark");
      themeBtn.innerHTML = '<i class="fas fa-moon"></i>';
    }
    
    chatState.save();
    NotificationManager.show(
      `Th√®me ${chatState.isDarkTheme ? 'sombre' : 'clair'} activ√©`, 
      "success"
    );
  }
}

// ============== LANGUAGE MANAGEMENT ==============
class LanguageManager {
  static changeLanguage(newLang) {
    if (newLang === chatState.currentLang) return;
    
    const oldLang = chatState.currentLang;
    chatState.currentLang = newLang;
    
    // Update status indicator
    document.getElementById("status-indicator").textContent = translations[newLang].online;
    
    // Update search placeholder
    this.updateSearchPlaceholder();
    
    // Update quick questions
    this.updateQuickQuestions();
    
    // Show language change notification
    const langNames = { fr: 'Fran√ßais', en: 'English', de: 'Deutsch' };
    NotificationManager.show(
      `Langue chang√©e vers ${langNames[newLang]}`, 
      "success"
    );
    
    // Save state
    chatState.save();
  }

  static updateSearchPlaceholder() {
    const searchInput = document.getElementById("search-input");
    const placeholders = {
      fr: "Rechercher par mot-cl√© (ex: prix, s√©curit√©, formation...)",
      en: "Search by keyword (ex: price, security, training...)",
      de: "Nach Stichwort suchen (z.B: Preis, Sicherheit, Schulung...)"
    };
    
    if (searchInput) {
      searchInput.placeholder = placeholders[chatState.currentLang];
    }
  }

  static updateQuickQuestions() {
    const container = document.getElementById("questions-container");
    container.innerHTML = "";
    
    // Show random 2 questions
    const questions = [...quickQuestions[chatState.currentLang]]
      .sort(() => Math.random() - 0.5)
      .slice(0, 2);
    
    questions.forEach(question => {
      const btn = document.createElement("button");
      btn.className = "question-btn w-full text-left p-3 rounded-xl text-sm font-medium text-gray-700 bg-white/70 hover:bg-white transition-all";
      btn.textContent = question;
      btn.onclick = () => InputHandler.sendMessage(question);
      container.appendChild(btn);
    });
  }
}

// ============== CONNECTION MONITORING ==============
class ConnectionManager {
  static init() {
    window.addEventListener('online', () => this.updateStatus('online'));
    window.addEventListener('offline', () => this.updateStatus('offline'));
    
    // Simulate periodic connection check
    setInterval(() => this.checkConnection(), 30000);
  }

  static updateStatus(status) {
    chatState.connectionStatus = status;
    const dot = document.getElementById('connection-dot');
    const indicator = document.getElementById('status-indicator');
    
    dot.className = `status-dot ${status === 'online' ? '' : 'status-offline'}`;
    indicator.textContent = status === 'online' ? 
      translations[chatState.currentLang].online : 'Hors ligne';
    
    if (status === 'offline') {
      NotificationManager.show("Connexion perdue", "warning", "Certaines fonctionnalit√©s peuvent √™tre limit√©es");
    } else {
      NotificationManager.show("Connexion r√©tablie", "success");
    }
  }

  static checkConnection() {
    // Simulate connection check
    if (navigator.onLine) {
      this.updateStatus('online');
    } else {
      this.updateStatus('offline');
    }
  }
}

// ============== QUICK ACTIONS ==============
function handleQuickAction(action) {
  const actions = {
    fr: {
      demo: "J'aimerais voir une d√©monstration de vos solutions IA pour la finance.",
      contact: "Comment puis-je contacter votre √©quipe commerciale ?",
      pricing: "Pouvez-vous me donner plus d'informations sur vos tarifs ?"
    },
    en: {
      demo: "I would like to see a demonstration of your AI solutions for finance.",
      contact: "How can I contact your sales team?",
      pricing: "Can you give me more information about your pricing?"
    },
    de: {
      demo: "Ich m√∂chte eine Demonstration Ihrer KI-L√∂sungen f√ºr das Finanzwesen sehen.",
      contact: "Wie kann ich Ihr Vertriebsteam kontaktieren?",
      pricing: "K√∂nnen Sie mir mehr Informationen zu Ihren Preisen geben?"
    }
  };
  
  const message = actions[chatState.currentLang][action];
  if (message) {
    InputHandler.sendMessage(message);
  }
}

function showAIInsights() {
  const insights = [
    "üìä Votre activit√© de chat sugg√®re un int√©r√™t pour l'automatisation",
    "üéØ Les entreprises de votre taille √©conomisent en moyenne 40% avec nos solutions",
    "‚ö° D√©lai moyen d'impl√©mentation : 2-3 mois pour votre secteur"
  ];
  
  const randomInsight = insights[Math.floor(Math.random() * insights.length)];
  MessageHandler.addMessage(randomInsight, "bot", { 
    confidence: 0.8,
    relatedQuestions: ["Puis-je demander une d√©mo ?", "Quels sont vos tarifs ?"]
  });
}

// ============== SMART COMPOSE ==============
function showSmartCompose() {
  const suggestions = [
    "Pouvez-vous m'expliquer",
    "J'aimerais en savoir plus sur",
    "Quels sont les avantages de",
    "Comment puis-je",
    "Proposez-vous"
  ];
  
  const input = document.getElementById("user-input");
  const currentText = input.value;
  
  const suggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
  input.value = currentText + (currentText ? " " : "") + suggestion + " ";
  input.focus();
  InputHandler.autoResize(input);
}

// ============== ADVANCED SEARCH ==============
function toggleAdvancedSearch() {
  document.getElementById('advanced-search-modal').classList.remove('hidden');
}

function closeAdvancedSearch() {
  document.getElementById('advanced-search-modal').classList.add('hidden');
}

function performAdvancedSearch() {
  const category = document.getElementById('search-category').value;
  const date = document.getElementById('search-date').value;
  
  NotificationManager.show("Recherche avanc√©e simul√©e", "info", `Cat√©gorie: ${category}, P√©riode: ${date}`);
  closeAdvancedSearch();
}

// ============== UTILITY FUNCTIONS ==============
function refreshQuestions() {
  LanguageManager.updateQuickQuestions();
  NotificationManager.show("Questions actualis√©es", "success");
}

function toggleStats() {
  const stats = document.getElementById("conversation-stats");
  stats.style.display = stats.style.display === "block" ? "none" : "block";
}

function toggleDropdown() {
  document.getElementById("exportDropdown").classList.toggle("show");
}

// Re-export functions to global scope for backward compatibility
window.MessageHandler = MessageHandler;
window.InputHandler = InputHandler;
window
