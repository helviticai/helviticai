<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Helvitic AI Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .scrollbar-thin {
      scrollbar-width: thin;
      scrollbar-color: #cbd5e1 #f1f5f9;
    }
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
  </style>
</head>
<body>

<!-- Fen√™tre du chatbot -->
<div id="chatbot-window" class="w-full h-screen glass-effect flex flex-col">

  <!-- Header avec s√©lecteur de langue + bouton fermer -->
  <div class="gradient-bg text-white flex justify-between items-center p-4">
    <span class="font-bold">Helvitic AI</span>

    <select id="lang-select" class="text-black rounded px-2 py-1">
      <option value="fr">üá´üá∑ FR</option>
      <option value="en">üá¨üáß EN</option>
      <option value="de">üá©üá™ DE</option>
    </select>

    <button onclick="parent.closeChatbot()" class="ml-2 text-lg font-bold">‚úï</button>
  </div>

  <!-- Messages -->
  <div id="chatbot-messages" class="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin"></div>

  <!-- FAQ rapide -->
  <div id="faq-container" class="p-3 border-t bg-gray-50">
    <div id="faq-title" class="font-semibold mb-2 text-gray-700"></div>
    <div id="faq-quick" class="flex flex-wrap gap-2"></div>
  </div>

  <!-- Formulaire -->
  <form id="bot-form" class="border-t border-gray-200 p-3 flex">
    <input id="bot-input" type="text" placeholder="√âcrivez ici..." 
           class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
    <button class="ml-2 px-4 bg-blue-600 text-white rounded-lg">Envoyer</button>
  </form>
</div>

<!-- Import de la base de connaissances -->
<script>
// Base de connaissances int√©gr√©e (au lieu de faq.js externe)
const faq = {
  fr: {
    "ia finance definition qu'est-ce": "L'IA appliqu√©e √† la performance financi√®re utilise des algorithmes avanc√©s, l'apprentissage automatique et l'analyse pr√©dictive pour automatiser et optimiser les processus de gestion financi√®re dans l'EPM (Enterprise Performance Management).",
    
    "avantages benefices ia epm finance": "Les avantages incluent : automatisation des processus (r√©duction 30-50% du temps), pr√©visions plus pr√©cises (+15-25%), d√©tection d'anomalies en temps r√©el, optimisation continue, et r√©duction significative des erreurs humaines dans les processus financiers.",
    
    "planification budgeting forecasting ia": "L'IA transforme la planification financi√®re via des mod√®les pr√©dictifs sophistiqu√©s, simulation de sc√©narios multiples en temps r√©el, int√©gration automatique de variables externes (march√©, √©conomie), et g√©n√©ration automatique de budgets/forecasts.",
    
    "processus automatisation epm finance": "Processus EPM automatisables avec l'IA : consolidation financi√®re multi-entit√©s, reporting automatis√© intelligent, budgeting/forecasting pr√©dictif, analyse de variance automatique, allocation des co√ªts optimis√©e, contr√¥le de gestion pr√©dictif.",
    
    "precision amelioration previsions forecasts": "L'IA am√©liore la pr√©cision des pr√©visions gr√¢ce √† l'analyse de patterns complexes dans l'historique, int√©gration de variables externes (indicateurs √©conomiques, saisonnalit√©), et apprentissage continu qui affine les mod√®les au fil du temps.",
    
    "analyse risques anomalies detection": "L'IA excelle dans l'analyse des risques financiers : d√©tection automatique d'anomalies dans les donn√©es, √©valuation de probabilit√©s de diff√©rents sc√©narios, surveillance continue des seuils critiques, et g√©n√©ration d'alertes pr√©ventives en temps r√©el.",
    
    "integration implementation deploiement ia epm": "L'int√©gration de l'IA en EPM suit 6 √©tapes cl√©s : 1) Audit de la qualit√© des donn√©es 2) D√©finition des cas d'usage prioritaires 3) S√©lection des technologies adapt√©es 4) Phase pilote contr√¥l√©e 5) D√©ploiement progressif 6) Formation compl√®te des √©quipes.",
    
    "prerequis techniques infrastructure ia": "Pr√©requis techniques : infrastructure cloud/on-premise suffisamment puissante, donn√©es propres et coh√©rentes, APIs robustes pour l'int√©gration, s√©curit√© renforc√©e pour donn√©es sensibles, comp√©tences IA/data science, gouvernance claire des processus.",
    
    "delais temps resultats timeline ia": "D√©lais pour premiers r√©sultats : 2-3 mois (d√©tection d'anomalies basique), 4-6 mois (automatisation de processus), 6-12 mois (mod√®les pr√©dictifs avanc√©s), 12-24 mois (transformation compl√®te EPM avec IA).",
    
    "technologies outils machine learning": "Technologies IA utilis√©es : Machine Learning (pr√©visions et classifications), Deep Learning (patterns complexes), Natural Language Processing (analyse textuelle), Computer Vision (documents/graphiques), RPA (automatisation t√¢ches), IA g√©n√©rative (cr√©ation rapports).",
    
    "solutions logiciels epm ia oracle sap": "Solutions EPM avec IA int√©gr√©e : Oracle EPM Cloud (pr√©dictif avanc√©), SAP Analytics Cloud (IA pour planning), IBM Planning Analytics (analyse cognitive), Microsoft Power BI (IA native), Workday Adaptive Planning (machine learning).",
    
    "roi retour investissement cout benefices": "ROI attendu avec l'IA : 200-400% sur 3 ans. Gains typiques mesur√©s : +30-50% productivit√© des √©quipes, +15-25% pr√©cision des pr√©visions, -20-35% r√©duction co√ªts processus, -40-60% r√©duction d√©lais de cl√¥ture comptable.",
    
    "contact aide support question": "Pour toute question ou projet IA en finance, contactez-nous : Email helviticaich@gmail.com, T√©l√©phone +41 22 123 45 67. Nous r√©pondons rapidement et proposons un premier √©change gratuit pour √©valuer vos besoins sp√©cifiques."
  },

  en: {
    "what ai finance definition artificial intelligence": "AI in financial performance uses advanced algorithms, machine learning and predictive analytics to automate and optimize financial management processes within EPM (Enterprise Performance Management) frameworks.",
    
    "benefits advantages ai epm finance": "Benefits include: process automation (30-50% time reduction), more accurate forecasts (+15-25%), real-time anomaly detection, continuous optimization, and significant reduction in human errors in financial processes.",
    
    "planning budgeting forecasting ai": "AI transforms financial planning through sophisticated predictive models, real-time multi-scenario simulation, automatic integration of external variables (market, economy), and automated budget/forecast generation.",
    
    "roi return investment cost benefits": "Expected AI ROI: 200-400% over 3 years. Typical measured gains: +30-50% team productivity, +15-25% forecast accuracy, -20-35% process cost reduction, -40-60% accounting closing time reduction.",
    
    "contact help support question": "For any AI in finance question or project, contact us: Email helviticaich@gmail.com, Phone +41 22 123 45 67. We respond quickly and offer a free initial consultation to assess your specific needs."
  },

  de: {
    "was ist ki finanzen definition": "KI in der Finanzperformance nutzt fortgeschrittene Algorithmen, maschinelles Lernen und pr√§diktive Analytik zur Automatisierung und Optimierung von Finanzmanagementprozessen im EPM-Rahmen (Enterprise Performance Management).",
    
    "vorteile nutzen ki epm finanzen": "Vorteile: Prozessautomatisierung (30-50% Zeitreduktion), pr√§zisere Prognosen (+15-25%), Echtzeit-Anomalieerkennung, kontinuierliche Optimierung, deutliche Reduzierung menschlicher Fehler in Finanzprozessen.",
    
    "roi rendite investition kosten nutzen": "Erwarteter KI-ROI: 200-400% √ºber 3 Jahre. Typische gemessene Gewinne: +30-50% Team-Produktivit√§t, +15-25% Prognosegenauigkeit, -20-35% Prozesskostenreduktion, -40-60% Reduzierung der Abschlusszeiten.",
    
    "kontakt hilfe support frage": "F√ºr jede KI-Finanz-Frage oder Projekt kontaktieren Sie uns: E-Mail helviticaich@gmail.com, Telefon +41 22 123 45 67. Wir antworten schnell und bieten eine kostenlose Erstberatung zur Bewertung Ihrer spezifischen Bed√ºrfnisse."
  }
};

const quickQuestions = {
  fr: [
    "Qu'est-ce que l'IA en finance ?",
    "Quels sont les avantages de l'IA pour l'EPM ?",
    "Comment int√©grer l'IA dans mon syst√®me ?",
    "Quel est le ROI de l'IA en finance ?",
    "Quelles technologies IA utilisez-vous ?"
  ],
  en: [
    "What is AI in finance?",
    "What are the benefits of AI for EPM?",
    "How to integrate AI in my system?",
    "What is the ROI of AI in finance?",
    "What AI technologies do you use?"
  ],
  de: [
    "Was ist KI im Finanzwesen?",
    "Was sind die Vorteile von KI f√ºr EPM?",
    "Wie integriere ich KI in mein System?",
    "Was ist der ROI von KI im Finanzwesen?",
    "Welche KI-Technologien verwenden Sie?"
  ]
};
</script>

<!-- Script principal du chatbot -->
<script>
const responses = {
  fr: { 
    welcome:"Bonjour üëã Je suis le chatbot Helvitic AI sp√©cialis√© en IA pour la performance financi√®re. Posez-moi vos questions sur l'EPM, l'automatisation ou nos solutions.",
    greeting:"Bonjour! Comment puis-je vous aider avec l'IA en finance ?",
    services:"Nous offrons des solutions IA pour l'EPM : pr√©visions automatis√©es, budgeting intelligent, d√©tection d'anomalies, et optimisation des processus financiers.",
    contact:"Vous pouvez nous contacter via email : helviticaich@gmail.com ou par t√©l√©phone +41 22 123 45 67.",
    goodbye:"Merci pour votre int√©r√™t ! N'h√©sitez pas √† nous recontacter pour vos projets IA & Finance üëã",
    unknown:"Je n'ai pas trouv√© d'information sur ce sujet. Pouvez-vous reformuler ou poser une question sur l'IA en finance, l'EPM, ou nos solutions ?" 
  },
  en: {
    welcome:"Hello üëã I'm the Helvitic AI chatbot specialized in AI for financial performance. Ask me about EPM, automation, or our solutions.",
    greeting:"Hello! How can I help you with AI in finance?",
    services:"We provide AI solutions for EPM: automated forecasting, intelligent budgeting, anomaly detection, and financial process optimization.",
    contact:"You can reach us via email: helviticaich@gmail.com or phone +41 22 123 45 67.",
    goodbye:"Thank you for your interest! Feel free to contact us again for your AI & Finance projects üëã",
    unknown:"I couldn't find information on this topic. Could you rephrase or ask about AI in finance, EPM, or our solutions?"
  },
  de: {
    welcome:"Hallo üëã Ich bin der Helvitic AI Chatbot f√ºr KI in der Finanzperformance. Fragen Sie mich zu EPM, Automatisierung oder unseren L√∂sungen.",
    greeting:"Hallo! Wie kann ich Ihnen mit KI im Finanzwesen helfen?",
    services:"Wir bieten KI-L√∂sungen f√ºr EPM: automatisierte Prognosen, intelligente Budgetierung, Anomalieerkennung und Optimierung von Finanzprozessen.",
    contact:"Sie erreichen uns per E-Mail: helviticaich@gmail.com oder Telefon +41 22 123 45 67.",
    goodbye:"Vielen Dank f√ºr Ihr Interesse! Kontaktieren Sie uns gerne f√ºr Ihre KI & Finance Projekte üëã",
    unknown:"Ich konnte keine Information zu diesem Thema finden. K√∂nnen Sie umformulieren oder zu KI im Finanzwesen, EPM oder unseren L√∂sungen fragen?"
  }
};

const faqData = {
  fr: {
    title: "‚ùì Questions fr√©quentes",
    questions: [
      "Quels services proposez-vous ?",
      "Comment vous contacter ?",
      "Pouvez-vous m'aider avec la finance ?"
    ]
  },
  en: {
    title: "‚ùì Frequently Asked Questions", 
    questions: [
      "What services do you provide?",
      "How can I contact you?",
      "Can you help me with finance?"
    ]
  },
  de: {
    title: "‚ùì H√§ufig gestellte Fragen",
    questions: [
      "Welche Dienstleistungen bieten Sie an?",
      "Wie kann ich Sie kontaktieren?",
      "K√∂nnen Sie mir bei Finanzen helfen?"
    ]
  }
};

let currentLang = "fr";

// S√©lecteurs
const botForm = document.getElementById("bot-form");
const botInput = document.getElementById("bot-input");
const botMessages = document.getElementById("chatbot-messages");
const langSelect = document.getElementById("lang-select");
const faqQuick = document.getElementById("faq-quick");
const faqTitle = document.getElementById("faq-title");

// Fonction affichage message
function addMessage(sender, text) {
  const div = document.createElement("div");
  div.className = sender === "bot" 
    ? "message-bot px-3 py-2 rounded-lg bg-gray-100 mb-2" 
    : "message-user px-3 py-2 rounded-lg text-right bg-blue-500 text-white mb-2";
  
  const formattedText = text.replace(/\n/g, '<br>');
  div.innerHTML = `<strong>${sender==="bot"?"Helvitic AI":"Vous"}:</strong> ${formattedText}`;
  
  botMessages.appendChild(div);
  botMessages.scrollTop = botMessages.scrollHeight;
}

// Fonction de recherche intelligente
function searchFAQ(query, lang = 'fr') {
  const faqLang = faq[lang] || faq.fr;
  const normalizedQuery = query.toLowerCase()
    .replace(/[√†√°√¢√£√§√•]/g, 'a')
    .replace(/[√®√©√™√´]/g, 'e')
    .replace(/[√¨√≠√Æ√Ø]/g, 'i')
    .replace(/[√≤√≥√¥√µ√∂]/g, 'o')
    .replace(/[√π√∫√ª√º]/g, 'u')
    .replace(/[√ß]/g, 'c')
    .replace(/[^a-z0-9\s]/g, ' ')
    .trim();

  const keywords = normalizedQuery.split(' ').filter(word => word.length > 2);
  let bestMatch = null;
  let maxScore = 0;

  for (const [key, value] of Object.entries(faqLang)) {
    let score = 0;
    const normalizedKey = key.toLowerCase();
    const normalizedValue = value.toLowerCase();

    keywords.forEach(keyword => {
      if (normalizedKey.includes(keyword)) score += 3;
      if (normalizedValue.includes(keyword)) score += 1;
    });

    if (normalizedKey.includes(normalizedQuery)) score += 5;

    if (score > maxScore) {
      maxScore = score;
      bestMatch = { key, value, score };
    }
  }

  return maxScore > 2 ? bestMatch : null;
}

// Suggestions de questions
function getSuggestedQuestions(lang) {
  const suggestions = quickQuestions[lang] || quickQuestions.fr;
  const randomSuggestions = suggestions.slice(0, 3);
  
  let suggestionText = "";
  switch(lang) {
    case 'en':
      suggestionText = "Here are some questions I can help with:\n‚Ä¢ " + randomSuggestions.join("\n‚Ä¢ ");
      break;
    case 'de':
      suggestionText = "Hier sind einige Fragen, bei denen ich helfen kann:\n‚Ä¢ " + randomSuggestions.join("\n‚Ä¢ ");
      break;
    default:
      suggestionText = "Voici quelques questions sur lesquelles je peux vous aider :\n‚Ä¢ " + randomSuggestions.join("\n‚Ä¢ ");
  }
  
  return suggestionText;
}

// Message de bienvenue
function showWelcomeMessage() {
  botMessages.innerHTML = "";
  addMessage("bot", responses[currentLang].welcome);
  loadFAQ();
}

// Gestion des messages utilisateur
function handleUserMessage(msg) {
  const normalizedMsg = msg.toLowerCase().trim();

  // Recherche dans la FAQ sp√©cialis√©e IA & Finance
  const faqResult = searchFAQ(normalizedMsg, currentLang);
  if (faqResult && faqResult.score > 2) {
    addMessage("bot", faqResult.value);
    return;
  }

  // R√©ponses basiques
  let reply = responses[currentLang].unknown;
  
  if (normalizedMsg.includes("bonjour") || normalizedMsg.includes("hello") || normalizedMsg.includes("hallo")) {
    reply = responses[currentLang].greeting;
  } else if (normalizedMsg.includes("service") || normalizedMsg.includes("solution")) {
    reply = responses[currentLang].services;
  } else if (normalizedMsg.includes("contact")) {
    reply = responses[currentLang].contact;
  } else if (normalizedMsg.includes("finance") || normalizedMsg.includes("epm") || normalizedMsg.includes("ia") || normalizedMsg.includes("ai") || normalizedMsg.includes("ki")) {
    reply = responses[currentLang].services;
  } else if (normalizedMsg.includes("bye") || normalizedMsg.includes("au revoir") || normalizedMsg.includes("tsch√ºss")) {
    reply = responses[currentLang].goodbye;
  }

  addMessage("bot", reply);

  // Suggestions si pas de r√©ponse trouv√©e
  if (reply === responses[currentLang].unknown) {
    setTimeout(() => {
      const suggestions = getSuggestedQuestions(currentLang);
      if (suggestions) {
        addMessage("bot", suggestions);
      }
    }, 1000);
  }
}

// Formulaire
botForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const msg = botInput.value.trim();
  if (!msg) return;
  
  addMessage("user", msg);
  botInput.value = "";
  
  setTimeout(() => {
    handleUserMessage(msg);
  }, 500);
});

// Charger FAQ
function loadFAQ() {
  if (!faqQuick || !faqTitle) return;
  
  faqQuick.innerHTML = "";
  faqTitle.textContent = faqData[currentLang].title;

  // Questions g√©n√©rales
  faqData[currentLang].questions.forEach(q => {
    const btn = document.createElement("button");
    btn.className = "faq-btn px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200 transition mr-2 mb-2";
    btn.innerText = q;
    btn.addEventListener("click", () => {
      addMessage("user", q);
      setTimeout(() => handleUserMessage(q), 500);
    });
    faqQuick.appendChild(btn);
  });

  // Questions sp√©cialis√©es IA & Finance
  if (quickQuestions[currentLang]) {
    quickQuestions[currentLang].slice(0, 4).forEach(q => {
      const btn = document.createElement("button");
      btn.className = "faq-btn px-3 py-1 bg-green-100 text-green-700 rounded-lg text-sm hover:bg-green-200 transition mr-2 mb-2";
      btn.innerText = q;
      btn.addEventListener("click", () => {
        addMessage("user", q);
        setTimeout(() => handleUserMessage(q), 500);
      });
      faqQuick.appendChild(btn);
    });
  }
}

// Changement de langue
if (langSelect) {
  langSelect.addEventListener("change", () => {
    currentLang = langSelect.value;
    showWelcomeMessage();
  });
}

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  showWelcomeMessage();
});

if (document.readyState !== 'loading') {
  showWelcomeMessage();
}
</script>

</body>
</html>
