<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Helvitic AI - Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); }
    .glass-effect { backdrop-filter: blur(10px); background: rgba(255,255,255,0.9); }
    .message-user { background: linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; display:inline-block; }
    .message-bot { background: #f3f4f6; border:1px solid #d1d5db; display:inline-block; }
    .scrollbar-thin::-webkit-scrollbar { width:4px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background:#cbd5e1; border-radius:2px; }
  </style>
</head>
<body class="bg-gray-50">

<!-- Fenêtre du chatbot -->
<div id="chatbot-window" class="w-full h-screen glass-effect flex flex-col">

  <!-- Header avec sélecteur de langue + bouton fermer -->
  <div class="gradient-bg text-white flex justify-between items-center p-4">
    <span class="font-bold">Helvitic AI</span>

    <select id="lang-select" class="text-black rounded px-2 py-1">
      <option value="fr">🇫🇷 FR</option>
      <option value="en">🇬🇧 EN</option>
      <option value="de">🇩🇪 DE</option>
    </select>

    <button onclick="parent.closeChatbot()" class="ml-2 text-lg font-bold">✕</button>
  </div>

  <!-- Messages -->
  <div id="chatbot-messages" class="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin"></div>

  <!-- FAQ rapide -->
  <div id="faq-suggestions" class="border-t border-gray-200 p-3 bg-gray-50 hidden">
    <p class="text-sm font-semibold mb-2">💡 Questions fréquentes :</p>
    <div id="faq-buttons" class="flex flex-col gap-2"></div>
  </div>

  <!-- Formulaire -->
  <form id="bot-form" class="border-t border-gray-200 p-3 flex">
    <input id="bot-input" type="text" placeholder="Écrivez ici..." 
           class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
    <button class="ml-2 px-4 bg-blue-600 text-white rounded-lg">Envoyer</button>
  </form>
</div>

<!-- Import FAQ -->
<script src="faq.js"></script>

<script>
let currentLang = "fr"; // langue par défaut

// Sélecteurs
const botForm = document.getElementById("bot-form");
const botInput = document.getElementById("bot-input");
const botMessages = document.getElementById("chatbot-messages");
const langSelect = document.getElementById("lang-select");
const faqContainer = document.getElementById("faq-suggestions");
const faqButtons = document.getElementById("faq-buttons");

// Fonction affichage message
function addMessage(sender, text) {
  const div = document.createElement("div");
  div.className = sender === "bot" 
    ? "message-bot px-3 py-2 rounded-lg" 
    : "message-user px-3 py-2 rounded-lg text-right";
  div.innerHTML = `<strong>${sender==="bot"?"Bot":"Vous"}:</strong> ${text}`;
  botMessages.appendChild(div);
  botMessages.scrollTop = botMessages.scrollHeight;
}

// Message de bienvenue
function showWelcomeMessage() {
  botMessages.innerHTML = "";
  addMessage("bot", faq[currentLang]?.welcome || "👋 Bonjour, posez-moi vos questions !");
  generateFaqButtons();
}

// Réponses normales
botForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const msg = botInput.value.trim();
  if (!msg) return;
  addMessage("user", msg);
  botInput.value = "";

  let reply = faq[currentLang]?.unknown || "❓ Je n’ai pas compris.";
  for (let key in faq[currentLang]) {
    if (msg.toLowerCase().includes(key.toLowerCase())) {
      reply = faq[currentLang][key];
      break;
    }
  }
  addMessage("bot", reply);
});

// FAQ cliquable
function askFaq(question, answer) {
  addMessage("user", question);
  addMessage("bot", answer);
}

// Générer automatiquement les boutons FAQ
function generateFaqButtons() {
  faqButtons.innerHTML = "";
  let entries = Object.entries(faq[currentLang] || {});

  // on prend uniquement les entrées de type question/réponse (Q1, Q2…)
  let qas = entries.filter(([k,v]) => k.startsWith("q")).slice(0, 5);

  if (qas.length > 0) {
    faqContainer.classList.remove("hidden");
    qas.forEach(([key, answer]) => {
      const btn = document.createElement("button");
      btn.innerText = key; // ⚠️ si faq.js contient le texte complet de la question, on peut remplacer par ça
      btn.className = "px-3 py-2 text-sm bg-blue-100 rounded-lg hover:bg-blue-200 text-left";
      btn.onclick = (e) => { e.preventDefault(); askFaq(key, answer); };
      faqButtons.appendChild(btn);
    });
  } else {
    faqContainer.classList.add("hidden");
  }
}

// Changement de langue
langSelect.addEventListener("change", () => {
  currentLang = langSelect.value;
  showWelcomeMessage();
});

// Lancer avec message d’accueil
showWelcomeMessage();
</script>
</body>
</html>
