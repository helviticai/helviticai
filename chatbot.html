<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Helvetic AI Chatbot</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

* { font-family: 'Inter', sans-serif; }

.dropdown{position:relative;display:inline-block}
.dropdown-content{display:none;position:absolute;right:0;background:#fff;min-width:160px;box-shadow:0 8px 32px rgba(0,0,0,.15);border-radius:12px;z-index:100;border:1px solid rgba(0,0,0,.1)}
.dropdown-content button{width:100%;text-align:left;padding:12px 16px;border:none;background:none;cursor:pointer;font-size:.875rem;transition:all 0.2s}
.dropdown-content button:hover{background:#f8fafc;color:#4f46e5}
.dropdown.show .dropdown-content{display:block;animation:slideDown 0.2s ease}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.line-clamp-5{display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical;overflow:hidden}

.chat-background{
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  position: relative;
}

.chat-background::before{
  content:"";
  position:absolute;
  top:0;left:0;right:0;bottom:0;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(10px);
  z-index:0
}

#chatbot-messages>div{position:relative;z-index:1}

.message-bubble-bot, .message-bubble-user{
  animation: messageSlide 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

@keyframes messageSlide {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.typing-indicator {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: rgba(255,255,255,0.9);
  border-radius: 18px;
  margin: 8px 0;
  max-width: fit-content;
  animation: messageSlide 0.3s ease;
}

.typing-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #9ca3af;
  margin: 0 2px;
  animation: typingAnimation 1.4s infinite;
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingAnimation {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
  30% { transform: translateY(-10px); opacity: 1; }
}

.gradient-header {
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  position: relative;
  overflow: hidden;
}

.gradient-header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  animation: shimmer 3s linear infinite;
}

@keyframes shimmer {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.status-pulse {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 1; }
}

.question-btn {
  transition: all 0.3s ease;
  border: 1px solid rgba(79, 70, 229, 0.2);
}

.question-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(79, 70, 229, 0.15);
  border-color: #4f46e5;
}

.input-container {
  position: relative;
  background: white;
  border-radius: 24px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  border: 1px solid #e5e7eb;
  transition: all 0.3s ease;
}

.input-container:focus-within {
  box-shadow: 0 8px 32px rgba(79, 70, 229, 0.2);
  border-color: #4f46e5;
}

.voice-btn {
  transition: all 0.3s ease;
}

.voice-btn:hover {
  background: #ef4444;
  transform: scale(1.1);
}

.voice-recording {
  background: #ef4444 !important;
  animation: pulse 1s infinite;
}

.attachment-preview {
  max-width: 200px;
  max-height: 100px;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.sentiment-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 8px;
}

.sentiment-positive { background: #10b981; }
.sentiment-neutral { background: #6b7280; }
.sentiment-negative { background: #ef4444; }

.theme-dark {
  background: #1f2937;
  color: #f9fafb;
}

.theme-dark .chat-background::before {
  background: rgba(31, 41, 55, 0.95);
}

.theme-dark .message-bubble-bot {
  background: #374151;
  color: #f9fafb;
}

.theme-dark .input-container {
  background: #374151;
  border-color: #4b5563;
}

.satisfaction-rating {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.rating-star {
  cursor: pointer;
  font-size: 18px;
  color: #d1d5db;
  transition: all 0.2s ease;
}

.rating-star:hover,
.rating-star.active {
  color: #fbbf24;
  transform: scale(1.2);
}

.message-actions {
  opacity: 0;
  transition: opacity 0.3s ease;
  margin-top: 8px;
  display: flex;
  gap: 8px;
}

.message-container:hover .message-actions {
  opacity: 1;
}

.action-btn {
  padding: 4px 8px;
  background: rgba(0,0,0,0.05);
  border: none;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.action-btn:hover {
  background: rgba(0,0,0,0.1);
}

.quick-actions {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.quick-action {
  padding: 8px 16px;
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  color: white;
  border: none;
  border-radius: 20px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.quick-action:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
}

.conversation-stats {
  position: absolute;
  top: 100%;
  right: 0;
  background: white;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
  padding: 16px;
  min-width: 200px;
  z-index: 1000;
  display: none;
}

.progress-bar {
  width: 100%;
  height: 4px;
  background: rgba(0,0,0,0.1);
  border-radius: 2px;
  overflow: hidden;
  margin-top: 8px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #4f46e5, #7c3aed);
  transition: width 0.3s ease;
}

.search-suggestion {
  padding: 12px 16px;
  cursor: pointer;
  border-bottom: 1px solid #f3f4f6;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.search-suggestion:hover {
  background: #f8fafc;
  border-left: 3px solid #4f46e5;
}

.search-suggestion:last-child {
  border-bottom: none;
}

.suggestion-text {
  flex: 1;
  font-size: 14px;
  color: #374151;
}

.suggestion-keywords {
  font-size: 11px;
  color: #9ca3af;
  background: #f3f4f6;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
}

.search-active #search-toggle {
  color: #4f46e5;
  background: #eff6ff;
  border-radius: 6px;
}

.search-highlight {
  background: #fef3c7;
  padding: 1px 2px;
  border-radius: 2px;
}

.search-category {
  padding: 8px 16px;
  background: #f8fafc;
  border-bottom: 1px solid #e5e7eb;
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

@media (max-width: 640px) {
  .search-suggestion {
    padding: 10px 12px;
  }
  
  .suggestion-keywords {
    display: none;
  }
}
</style>
</head>
<body>
<div id="chatbot-window" class="w-full h-screen flex flex-col relative overflow-hidden">
  <!-- Header -->
  <div class="gradient-header text-white flex justify-between items-center p-4 shadow-2xl relative z-10">
    <div class="flex items-center space-x-2 sm:space-x-4">
      <div class="logo-container w-12 h-12 rounded-full flex items-center justify-center overflow-hidden bg-white/20 backdrop-blur-sm">
        <svg width="28" height="28" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" fill="#FF0000" rx="4"/>
          <rect x="6" y="13" width="20" height="6" fill="#FFF" rx="1"/>
          <rect x="13" y="6" width="6" height="20" fill="#FFF" rx="1"/>
        </svg>
      </div>
      <div class="min-w-0 flex-1">
        <span class="font-bold text-base sm:text-lg">Helvetic AI</span>
        <div class="flex items-center text-xs sm:text-sm opacity-90">
          <div class="status-pulse pl-3 truncate" id="status-indicator">En ligne</div>
          <div class="sentiment-indicator sentiment-positive ml-2" id="sentiment-indicator"></div>
        </div>
      </div>
    </div>
    <div class="flex items-center space-x-2 sm:space-x-3">
      <!-- Stats Button -->
      <button onclick="toggleStats()" class="relative px-3 py-1 bg-white/20 rounded text-sm">
        <i class="fas fa-chart-line mr-1"></i> Stats
        <div class="conversation-stats" id="conversation-stats">
          <h4 class="font-bold text-gray-800 mb-2">Statistiques</h4>
          <div class="text-sm text-gray-600">
            <div>Messages: <span id="message-count">0</span></div>
            <div>Satisfaction: <span id="avg-rating">N/A</span>/5</div>
            <div>Temps de rÃ©ponse: <span id="avg-response-time">0.8s</span></div>
          </div>
        </div>
      </button>
      
      <!-- Export Dropdown -->
      <div class="dropdown" id="exportDropdown">
        <button onclick="toggleDropdown()" class="px-3 py-1 bg-white/20 rounded text-sm">
          <i class="fas fa-download mr-1"></i> Exporter
        </button>
        <div class="dropdown-content">
          <button onclick="exportConversation('txt')">
            <i class="fas fa-file-text mr-2"></i> Exporter en TXT
          </button>
          <button onclick="exportConversation('json')">
            <i class="fas fa-file-code mr-2"></i> Exporter en JSON
          </button>
          <button onclick="exportConversation('pdf')">
            <i class="fas fa-file-pdf mr-2"></i> Exporter en PDF
          </button>
        </div>
      </div>
      
      <!-- Theme Toggle -->
      <button onclick="toggleTheme()" class="px-3 py-1 bg-white/20 rounded text-sm" id="theme-toggle">
        <i class="fas fa-moon"></i>
      </button>
      
      <!-- Language Select -->
      <select id="lang-select" class="text-gray-800 rounded-lg px-3 py-2 text-xs sm:text-sm font-medium appearance-none pr-6 sm:pr-8 focus:outline-none focus:ring-2 focus:ring-white/50 bg-white/90">
        <option value="fr">ðŸ‡«ðŸ‡· FR</option>
        <option value="en">ðŸ‡¬ðŸ‡§ EN</option>
        <option value="de">ðŸ‡©ðŸ‡ª DE</option>
      </select>
      
      <button onclick="parent.closeChatbot && parent.closeChatbot()" class="w-8 h-8 rounded-full flex items-center justify-center text-lg font-bold hover:bg-white/20 transition-colors">Ã—</button>
    </div>
  </div>
  
  <!-- Messages Area -->
  <div id="chatbot-messages" class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-3 sm:space-y-4 chat-background">
    <!-- Messages will be inserted here -->
  </div>
  
  <!-- Quick Actions -->
  <div class="bg-white/80 backdrop-blur-sm px-4 py-2">
    <div class="quick-actions" id="quick-actions">
      <button class="quick-action" onclick="handleQuickAction('demo')">
        <i class="fas fa-play mr-1"></i> DÃ©mo
      </button>
      <button class="quick-action" onclick="handleQuickAction('contact')">
        <i class="fas fa-envelope mr-1"></i> Contact
      </button>
      <button class="quick-action" onclick="handleQuickAction('pricing')">
        <i class="fas fa-tag mr-1"></i> Tarifs
      </button>
    </div>
  </div>
  
  <!-- Quick Questions -->
  <div class="border-t border-gray-200 bg-white/80 backdrop-blur-sm p-3 sm:p-4">
    <div class="text-xs sm:text-sm font-semibold text-gray-700 mb-2 flex items-center justify-between" id="questions-title">
      <div class="flex items-center">
        <i class="fas fa-question-circle w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-indigo-500"></i>
        Questions rapides :
      </div>
      <button onclick="refreshQuickQuestions()" class="text-indigo-600 hover:text-indigo-800 transition-colors text-xs">
        <i class="fas fa-sync-alt mr-1"></i>Autres
      </button>
    </div>
    <div id="questions-container" class="flex flex-wrap gap-2"></div>
  </div>
  
  <!-- Input Area -->
  <div class="bg-white p-4 border-t border-gray-200">
    <!-- File Preview -->
    <div id="file-preview" class="mb-3 hidden">
      <div class="flex items-center p-2 bg-gray-50 rounded-lg">
        <img id="preview-image" class="attachment-preview mr-3 hidden">
        <div id="preview-text" class="flex-1 text-sm text-gray-600"></div>
        <button onclick="clearFilePreview()" class="text-red-500 hover:text-red-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    
    <div class="input-container flex items-center p-2">
      <!-- Search Toggle Button -->
      <button onclick="toggleSearchMode()" class="p-2 text-gray-500 hover:text-indigo-600 transition-colors" id="search-toggle" title="Mode recherche">
        <i class="fas fa-search"></i>
      </button>
      
      <!-- Attachment Button -->
      <button onclick="document.getElementById('file-input').click()" class="p-2 text-gray-500 hover:text-indigo-600 transition-colors">
        <i class="fas fa-paperclip"></i>
      </button>
      <input type="file" id="file-input" class="hidden" accept="image/*,.pdf,.doc,.docx" onchange="handleFileUpload(event)">
      
      <!-- Text Input -->
      <input id="user-input" type="text" placeholder="Posez votre question..." 
             class="flex-1 p-2 border-none outline-none text-sm bg-transparent"
             onkeypress="handleKeyPress(event)"
             oninput="handleInputChange(event)">
      
      <!-- Voice Button -->
      <button onclick="toggleVoiceRecording()" class="voice-btn p-2 text-gray-500 hover:text-red-500 transition-all rounded-full mr-2" id="voice-btn">
        <i class="fas fa-microphone"></i>
      </button>
      
      <!-- Send Button -->
      <button onclick="handleUserInput()" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all font-medium">
        <i class="fas fa-paper-plane mr-1"></i> Envoyer
      </button>
    </div>
    
    <!-- Search Suggestions -->
    <div id="search-suggestions" class="hidden bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto mt-2 mx-4">
      <!-- Suggestions will be populated here -->
    </div>
  </div>
</div>

<script>
// Enhanced data structure
const quickQuestions = {
  fr: [
    "Qu'est-ce que l'IA en finance ?",
    "Quels sont vos services ?", 
    "Quels sont les avantages de l'EPM ?",
    "Combien coÃ»te une implÃ©mentation IA ?",
    "Comment garantissez-vous la sÃ©curitÃ© ?",
    "Puis-je demander une dÃ©mo ?",
    "Quelles sont vos rÃ©fÃ©rences clients ?",
    "Combien de temps dure l'implÃ©mentation ?",
    "Proposez-vous de la formation ?",
    "Quels sont vos partenariats ?"
  ],
  en: [
    "What is AI in finance?",
    "What services do you offer?",
    "What are the benefits of EPM?", 
    "How much does AI implementation cost?",
    "How do you ensure data security?",
    "Can I request a demo?",
    "What are your client references?",
    "How long does implementation take?",
    "Do you provide training?",
    "What are your partnerships?"
  ],
  de: [
    "Was ist KI im Finanzwesen?",
    "Welche Dienstleistungen bieten Sie an?",
    "Was sind die Vorteile von EPM?",
    "Wie viel kostet eine KI-Implementierung?",
    "Wie garantieren Sie Datensicherheit?",
    "Kann ich eine Demo anfordern?",
    "Was sind Ihre Kundenreferenzen?",
    "Wie lange dauert die Implementierung?",
    "Bieten Sie Schulungen an?",
    "Was sind Ihre Partnerschaften?"
  ]
};

const translations = {
  fr: {
    welcome: `âœ¨ Helvetic AI â€“ L'intelligence artificielle au service de la performance financiÃ¨re âœ¨

Helvetic AI accompagne les directions financiÃ¨res dans leur transformation digitale.
Notre ambition : mettre la puissance de l'intelligence artificielle et de l'Enterprise Performance Management (EPM) au service des dÃ©cideurs, pour transformer la donnÃ©e en vÃ©ritable levier stratÃ©gique.

ðŸ”¹ Une expertise unique : rigueur suisse + approche pragmatique et orientÃ©e rÃ©sultats.
ðŸ”¹ Des solutions concrÃ¨tes : automatisation des processus, analyse prÃ©dictive, optimisation budgÃ©taire, pilotage de la performance.
ðŸ”¹ Un engagement fort : fiabilitÃ© opÃ©rationnelle, innovation maÃ®trisÃ©e, conformitÃ© rÃ©glementaire.

ðŸ‘‰ Avec Helvetic AI, la performance financiÃ¨re devient plus intelligente, plus rapide et plus sÃ»re.`,
    online: "En ligne",
    readMore: "Lire plus",
    readLess: "Lire moins",
    typing: "En train d'Ã©crire...",
    rateResponse: "Ã‰valuez cette rÃ©ponse :",
    searchPlaceholder: "Rechercher dans la base de connaissances...",
    inputPlaceholder: "Posez votre question..."
  },
  en: {
    welcome: `âœ¨ Helvetic AI â€“ Artificial Intelligence at the service of financial performance âœ¨

Helvetic AI supports CFOs in their digital transformation, turning data into a real strategic lever through AI and EPM.

ðŸ”¹ Unique expertise: Swiss precision combined with pragmatic, results-oriented methods.
ðŸ”¹ Concrete solutions: automation, predictive analysis, budgeting optimization, performance management.
ðŸ”¹ Strong commitment: operational reliability, controlled innovation, full compliance.

ðŸ‘‰ With Helvetic AI, financial performance becomes smarter, faster and safer.`,
    online: "Online",
    readMore: "Read more", 
    readLess: "Read less",
    typing: "Typing...",
    rateResponse: "Rate this response:",
    searchPlaceholder: "Search in knowledge base...",
    inputPlaceholder: "Ask your question..."
  },
  de: {
    welcome: `âœ¨ Helvetic AI â€“ KÃ¼nstliche Intelligenz im Dienste der Finanzperformance âœ¨

Helvetic AI begleitet Finanzdirektionen bei der digitalen Transformation und macht Daten dank KI und EPM zu einem echten strategischen Hebel.

ðŸ”¹ Einzigartige Expertise: Schweizer PrÃ¤zision + pragmatische, ergebnisorientierte AnsÃ¤tze.
ðŸ”¹ Konkrete LÃ¶sungen: Automatisierung, prÃ¤diktive Analysen, Budgetoptimierung, Performance-Steuerung.
ðŸ”¹ Starkes Engagement: operative ZuverlÃ¤ssigkeit, kontrollierte Innovation, volle Compliance.

ðŸ‘‰ Mit Helvetic AI wird die Finanzperformance intelligenter, schneller und sicherer.`,
    online: "Online",
    readMore: "Mehr lesen",
    readLess: "Weniger lesen",
    typing: "Schreibt...",
    rateResponse: "Bewerten Sie diese Antwort:",
    searchPlaceholder: "In Wissensbasis suchen...",
    inputPlaceholder: "Stellen Sie Ihre Frage..."
  }
};

// Base de connaissances complÃ¨te IA & Performance FinanciÃ¨re EPM
const faq = {
  fr: {
    // Questions spÃ©cialisÃ©es IA & Finance avec mots-clÃ©s de recherche
    "ia finance definition qu'est-ce": "L'IA appliquÃ©e Ã  la performance financiÃ¨re utilise des algorithmes avancÃ©s, l'apprentissage automatique et l'analyse prÃ©dictive pour automatiser et optimiser les processus de gestion financiÃ¨re dans l'EPM (Enterprise Performance Management).",
    
    "avantages benefices ia epm finance": "Les avantages incluent : automatisation des processus (rÃ©duction 30-50% du temps), prÃ©visions plus prÃ©cises (+15-25%), dÃ©tection d'anomalies en temps rÃ©el, optimisation continue, et rÃ©duction significative des erreurs humaines dans les processus financiers.",
    
    "planification budgeting forecasting ia": "L'IA transforme la planification financiÃ¨re via des modÃ¨les prÃ©dictifs sophistiquÃ©s, simulation de scÃ©narios multiples en temps rÃ©el, intÃ©gration automatique de variables externes (marchÃ©, Ã©conomie), et gÃ©nÃ©ration automatique de budgets/forecasts.",
    
    "processus automatisation epm finance": "Processus EPM automatisables avec l'IA : consolidation financiÃ¨re multi-entitÃ©s, reporting automatisÃ© intelligent, budgeting/forecasting prÃ©dictif, analyse de variance automatique, allocation des coÃ»ts optimisÃ©e, contrÃ´le de gestion prÃ©dictif.",
    
    "precision amelioration previsions forecasts": "L'IA amÃ©liore la prÃ©cision des prÃ©visions grÃ¢ce Ã  l'analyse de patterns complexes dans l'historique, intÃ©gration de variables externes (indicateurs Ã©conomiques, saisonnalitÃ©), et apprentissage continu qui affine les modÃ¨les au fil du temps.",
    
    "analyse risques anomalies detection": "L'IA excelle dans l'analyse des risques financiers : dÃ©tection automatique d'anomalies dans les donnÃ©es, Ã©valuation de probabilitÃ©s de diffÃ©rents scÃ©narios, surveillance continue des seuils critiques, et gÃ©nÃ©ration d'alertes prÃ©ventives en temps rÃ©el.",
    
    "integration implementation deploiement ia epm": "L'intÃ©gration de l'IA en EPM suit 6 Ã©tapes clÃ©s : 1) Audit de la qualitÃ© des donnÃ©es 2) DÃ©finition des cas d'usage prioritaires 3) SÃ©lection des technologies adaptÃ©es 4) Phase pilote contrÃ´lÃ©e 5) DÃ©ploiement progressif 6) Formation complÃ¨te des Ã©quipes.",
    
    "prerequis techniques infrastructure ia": "PrÃ©requis techniques : infrastructure cloud/on-premise suffisamment puissante, donnÃ©es propres et cohÃ©rentes, APIs robustes pour l'intÃ©gration, sÃ©curitÃ© renforcÃ©e pour donnÃ©es sensibles, compÃ©tences IA/data science, gouvernance claire des processus.",
    
    "delais temps resultats timeline ia": "DÃ©lais pour premiers rÃ©sultats : 2-3 mois (dÃ©tection d'anomalies basique), 4-6 mois (automatisation de processus), 6-12 mois (modÃ¨les prÃ©dictifs avancÃ©s), 12-24 mois (transformation complÃ¨te EPM avec IA).",
    
    "technologies outils machine learning": "Technologies IA utilisÃ©es : Machine Learning (prÃ©visions et classifications), Deep Learning (patterns complexes), Natural Language Processing (analyse textuelle), Computer Vision (documents/graphiques), RPA (automatisation tÃ¢ches), IA gÃ©nÃ©rative (crÃ©ation rapports).",
    
    "solutions logiciels epm ia oracle sap": "Solutions EPM avec IA intÃ©grÃ©e : Oracle EPM Cloud (prÃ©dictif avancÃ©), SAP Analytics Cloud (IA pour planning), IBM Planning Analytics (analyse cognitive), Microsoft Power BI (IA native), Workday Adaptive Planning (machine learning).",
    
    "choix selection solution epm ia": "CritÃ¨res de choix de solution : adÃ©quation parfaite aux besoins mÃ©tier spÃ©cifiques, compatibilitÃ© avec Ã©cosystÃ¨me IT existant, facilitÃ© d'utilisation pour les Ã©quipes finance, scalabilitÃ© future, qualitÃ© du support/formation Ã©diteur, ROI global sur 3-5 ans.",
    
    "roi retour investissement cout benefices": "ROI attendu avec l'IA : 200-400% sur 3 ans. Gains typiques mesurÃ©s : +30-50% productivitÃ© des Ã©quipes, +15-25% prÃ©cision des prÃ©visions, -20-35% rÃ©duction coÃ»ts processus, -40-60% rÃ©duction dÃ©lais de clÃ´ture comptable.",
    
    "mesurer kpi indicateurs performance impact": "KPIs pour mesurer l'impact IA : prÃ©cision des prÃ©visions (Ã©cart prÃ©vu/rÃ©alisÃ©), temps de traitement des processus, taux d'automatisation atteint, qualitÃ© des donnÃ©es, satisfaction utilisateur, impact mesurable sur dÃ©cisions stratÃ©giques.",
    
    "defis challenges problemes difficultes ia": "DÃ©fis principaux de l'IA en EPM : qualitÃ© des donnÃ©es (critique pour le succÃ¨s), rÃ©sistance au changement des Ã©quipes, complexitÃ© technique d'implÃ©mentation, besoins de gouvernance renforcÃ©e, sÃ©curitÃ© des donnÃ©es financiÃ¨res sensibles, investissements initiaux consÃ©quents.",
    
    "fiabilite qualite controle validation ia": "Assurer la fiabilitÃ© des rÃ©sultats IA : validation croisÃ©e avec mÃ©thodes traditionnelles, tests rÃ©guliers des modÃ¨les, transparence des algorithmes utilisÃ©s, contrÃ´les qualitÃ© systÃ©matiques, boucles de feedback continues, audit trails complets pour traÃ§abilitÃ©.",
    
    "formation training equipes competences": "Formation des Ã©quipes Ã  l'IA : sensibilisation aux concepts IA de base, prÃ©sentation de cas d'usage financiers concrets, manipulation des outils pratiques, interprÃ©tation correcte des rÃ©sultats IA, bonnes pratiques de gouvernance, programmes de formation continue.",
    
    "remplacement emplois controleurs gestionnaires": "Non, l'IA ne remplace pas les contrÃ´leurs de gestion. Elle Ã©limine les tÃ¢ches rÃ©pÃ©titives et chronophages, libÃ¨re du temps pour l'analyse Ã  valeur ajoutÃ©e, et renforce leur rÃ´le stratÃ©gique de conseil et d'interprÃ©tation des insights gÃ©nÃ©rÃ©s par l'IA.",
    
    "cout prix tarif implementation ia finance": "CoÃ»ts d'implÃ©mentation IA variables : solutions simples 50-100Kâ‚¬, projets de taille moyenne 200-500Kâ‚¬, transformation complÃ¨te 500K-2Mâ‚¬. ROI gÃ©nÃ©ralement atteint en 18-24 mois selon la complexitÃ© et l'ampleur du projet.",
    
    "securite protection donnees confidentialite": "SÃ©curitÃ© des donnÃ©es financiÃ¨res : chiffrement bout-en-bout des flux, contrÃ´les d'accÃ¨s stricts basÃ©s sur les rÃ´les, audit trails complets, conformitÃ© RGPD stricte, hÃ©bergement sÃ©curisÃ© (Swiss hosting disponible), anonymisation des donnÃ©es sensibles.",
    
    "budgeting budget ia automatique": "IA pour budgeting : prÃ©visions bottom-up automatisÃ©es basÃ©es sur l'analyse de l'historique, ajustements dynamiques selon l'Ã©volution de l'actualitÃ©, simulation de scÃ©narios multiples, optimisation intelligente de l'allocation des ressources, validation automatique de cohÃ©rence.",
    
    "reporting rapports automatiques ia": "IA pour reporting : gÃ©nÃ©ration automatique de rapports financiers standardisÃ©s, crÃ©ation de narratives explicatives intelligentes, visualisations adaptatives selon l'audience, alertes automatiques sur KPIs critiques, personnalisation complÃ¨te selon profil utilisateur.",
    
    "consolidation comptable ia multi entites": "IA pour consolidation : automatisation des Ã©critures de consolidation complexes, dÃ©tection intelligente d'incohÃ©rences inter-entitÃ©s, optimisation drastique des dÃ©lais de clÃ´ture, contrÃ´les qualitÃ© automatiques avancÃ©s, reporting multi-normes (IFRS/US GAAP) unifiÃ©.",
    
    "tendances trends futur esg generative": "Tendances IA Ã©mergentes en EPM : IA gÃ©nÃ©rative pour crÃ©ation automatique de contenus, real-time analytics continu, dÃ©mocratisation des outils IA, IA explicable (transparence totale), edge computing pour performance, intÃ©gration critÃ¨res ESG automatisÃ©e.",
    
    "contact aide support question": "Pour toute question ou projet IA en finance, contactez-nous : Email helviticaich@gmail.com, TÃ©lÃ©phone +41 22 123 45 67. Nous rÃ©pondons rapidement et proposons un premier Ã©change gratuit pour Ã©valuer vos besoins spÃ©cifiques."
  },

  en: {
    "what ai finance definition artificial intelligence": "AI in financial performance uses advanced algorithms, machine learning and predictive analytics to automate and optimize financial management processes within EPM (Enterprise Performance Management) frameworks.",
    
    "benefits advantages ai epm finance": "Benefits include: process automation (30-50% time reduction), more accurate forecasts (+15-25%), real-time anomaly detection, continuous optimization, and significant reduction in human errors in financial processes.",
    
    "planning budgeting forecasting ai": "AI transforms financial planning through sophisticated predictive models, real-time multi-scenario simulation, automatic integration of external variables (market, economy), and automated budget/forecast generation.",
    
    "processes automation epm finance": "EPM processes automatable with AI: multi-entity financial consolidation, intelligent automated reporting, predictive budgeting/forecasting, automatic variance analysis, optimized cost allocation, predictive management control.",
    
    "accuracy improvement forecasts predictions": "AI improves forecast accuracy through complex pattern analysis in historical data, integration of external variables (economic indicators, seasonality), and continuous learning that refines models over time.",
    
    "risk analysis anomaly detection": "AI excels in financial risk analysis: automatic anomaly detection in data, probability assessment of different scenarios, continuous monitoring of critical thresholds, and real-time preventive alert generation.",
    
    "integration implementation deployment ai epm": "AI EPM integration follows 6 key steps: 1) Data quality audit 2) Priority use case definition 3) Appropriate technology selection 4) Controlled pilot phase 5) Progressive deployment 6) Comprehensive team training.",
    
    "technical prerequisites infrastructure ai": "Technical prerequisites: sufficiently powerful cloud/on-premise infrastructure, clean consistent data, robust APIs for integration, enhanced security for sensitive data, AI/data science skills, clear process governance.",
    
    "timeline results implementation ai": "Timeline for first results: 2-3 months (basic anomaly detection), 4-6 months (process automation), 6-12 months (advanced predictive models), 12-24 months (complete EPM transformation with AI).",
    
    "technologies tools machine learning": "AI technologies used: Machine Learning (forecasting and classification), Deep Learning (complex patterns), Natural Language Processing (text analysis), Computer Vision (documents/charts), RPA (task automation), Generative AI (report creation).",
    
    "solutions software epm ai oracle sap": "EPM solutions with integrated AI: Oracle EPM Cloud (advanced predictive), SAP Analytics Cloud (AI for planning), IBM Planning Analytics (cognitive analysis), Microsoft Power BI (native AI), Workday Adaptive Planning (machine learning).",
    
    "roi return investment cost benefits": "Expected AI ROI: 200-400% over 3 years. Typical measured gains: +30-50% team productivity, +15-25% forecast accuracy, -20-35% process cost reduction, -40-60% accounting closing time reduction.",
    
    "contact help support question": "For any AI in finance question or project, contact us: Email helviticaich@gmail.com, Phone +41 22 123 45 67. We respond quickly and offer a free initial consultation to assess your specific needs."
  },

  de: {
    "was ist ki finanzen definition": "KI in der Finanzperformance nutzt fortgeschrittene Algorithmen, maschinelles Lernen und prÃ¤diktive Analytik zur Automatisierung und Optimierung von Finanzmanagementprozessen im EPM-Rahmen (Enterprise Performance Management).",
    
    "vorteile nutzen ki epm finanzen": "Vorteile: Prozessautomatisierung (30-50% Zeitreduktion), prÃ¤zisere Prognosen (+15-25%), Echtzeit-Anomalieerkennung, kontinuierliche Optimierung, deutliche Reduzierung menschlicher Fehler in Finanzprozessen.",
    
    "planung budgetierung prognosen ki": "KI transformiert Finanzplanung durch sophisticated prÃ¤diktive Modelle, Echtzeit-Multi-Szenario-Simulation, automatische Integration externer Variablen (Markt, Wirtschaft), automatisierte Budget-/Prognosenerstellung.",
    
    "prozesse automatisierung epm finanzen": "EPM-Prozesse automatisierbar mit KI: Multi-Entity-Finanzkonsolidierung, intelligente automatisierte Berichterstattung, prÃ¤diktive Budgetierung/Forecasting, automatische Varianzanalyse, optimierte Kostenverteilung, prÃ¤diktive Unternehmenssteuerung.",
    
    "roi rendite investition kosten nutzen": "Erwarteter KI-ROI: 200-400% Ã¼ber 3 Jahre. Typische gemessene Gewinne: +30-50% Team-ProduktivitÃ¤t, +15-25% Prognosegenauigkeit, -20-35% Prozesskostenreduktion, -40-60% Reduzierung der Abschlusszeiten.",
    
    "kontakt hilfe support frage": "FÃ¼r jede KI-Finanz-Frage oder Projekt kontaktieren Sie uns: E-Mail helviticaich@gmail.com, Telefon +41 22 123 45 67. Wir antworten schnell und bieten eine kostenlose Erstberatung zur Bewertung Ihrer spezifischen BedÃ¼rfnisse."
  }
};

// Enhanced responses with more detailed information
const responses = {
  fr: {
    "Qu'est-ce que l'IA en finance ?": "L'IA en finance rÃ©volutionne la gestion financiÃ¨re en automatisant les tÃ¢ches rÃ©pÃ©titives, en amÃ©liorant la prÃ©cision des prÃ©visions grÃ¢ce Ã  l'analyse prÃ©dictive, et en permettant une prise de dÃ©cision basÃ©e sur des donnÃ©es en temps rÃ©el. Nos solutions incluent la dÃ©tection de fraudes, l'optimisation des investissements, et l'automatisation du reporting financier.",
    "Quels sont vos services ?": "Helvetic AI propose une gamme complÃ¨te de services : \nâ€¢ Automatisation des processus financiers (P2P, O2C, R2R)\nâ€¢ Solutions EPM (budgeting, forecasting, consolidation)\nâ€¢ Analyse prÃ©dictive et business intelligence\nâ€¢ Gestion des risques et compliance\nâ€¢ Formation et accompagnement au changement\nâ€¢ Support et maintenance 24/7",
    "Quels sont les avantages de l'EPM ?": "L'EPM (Enterprise Performance Management) apporte des bÃ©nÃ©fices majeurs :\nâ€¢ VisibilitÃ© en temps rÃ©el sur la performance\nâ€¢ Planification et budgeting plus agiles\nâ€¢ Consolidation financiÃ¨re automatisÃ©e\nâ€¢ RÃ©duction des erreurs de 90%\nâ€¢ Gain de temps de 60% sur le closing\nâ€¢ AmÃ©lioration de la prise de dÃ©cision stratÃ©gique",
    "Combien coÃ»te une implÃ©mentation IA ?": "Nos solutions sont modulaires et adaptÃ©es Ã  votre budget :\nâ€¢ Starter Pack : Ã  partir de 15 000 CHF\nâ€¢ Solution Standard : 50 000 - 150 000 CHF\nâ€¢ Solution Enterprise : sur devis\n\nInclus : licences, implÃ©mentation, formation, et 6 mois de support. ROI garanti en moins de 12 mois.",
    "Comment garantissez-vous la sÃ©curitÃ© ?": "La sÃ©curitÃ© est notre prioritÃ© absolue :\nâ€¢ ConformitÃ© ISO 27001, GDPR, et standards bancaires suisses\nâ€¢ Chiffrement end-to-end AES-256\nâ€¢ HÃ©bergement en Suisse avec redondance\nâ€¢ Audits de sÃ©curitÃ© trimestriels\nâ€¢ AccÃ¨s par authentification multi-facteurs\nâ€¢ Sauvegarde et disaster recovery automatisÃ©s",
    "Puis-je demander une dÃ©mo ?": "Absolument ! Nous proposons des dÃ©monstrations personnalisÃ©es :\nâ€¢ DÃ©mo live de 30 minutes adaptÃ©e Ã  vos besoins\nâ€¢ PrÃ©sentation de cas d'usage similaires Ã  votre secteur\nâ€¢ Q&A avec nos experts\nâ€¢ Proposition commerciale sur mesure\n\nContactez-nous sur demo@helvetic-ai.ch ou +41 22 123 45 67",
    "Quelles sont vos rÃ©fÃ©rences clients ?": "Nous accompagnons plus de 150+ entreprises en Suisse et en Europe :\nâ€¢ Banques privÃ©es et corporate\nâ€¢ Assurances et rÃ©assurances\nâ€¢ Multinationales (pharma, luxe, technologie)\nâ€¢ PME en croissance\n\nTaux de satisfaction client : 98%. RÃ©fÃ©rences disponibles sur demande.",
    "Combien de temps dure l'implÃ©mentation ?": "Nos dÃ©lais d'implÃ©mentation sont optimisÃ©s :\nâ€¢ Solution Starter : 4-6 semaines\nâ€¢ Solution Standard : 2-4 mois\nâ€¢ Solution Enterprise : 6-12 mois\n\nMÃ©thodologie agile avec livrables par sprints de 2 semaines. Go-live progressif pour minimiser les risques.",
    "Proposez-vous de la formation ?": "Oui, la formation fait partie intÃ©grante de notre approche :\nâ€¢ Formation des utilisateurs finaux (8h)\nâ€¢ Formation des administrateurs (16h)\nâ€¢ Formation des super-users (24h)\nâ€¢ Supports de formation personnalisÃ©s\nâ€¢ Sessions de refresh trimestrielles\nâ€¢ Certification disponible",
    "Quels sont vos partenariats ?": "Helvetic AI s'appuie sur un Ã©cosystÃ¨me de partenaires de premier plan :\nâ€¢ Microsoft (Gold Partner Azure)\nâ€¢ SAP (Certified Partner)\nâ€¢ Oracle (Gold Partner)\nâ€¢ Tableau (Technology Partner)\nâ€¢ IntÃ©gration avec 200+ applications mÃ©tier\n\nPartenaires d'implÃ©mentation en Suisse, France, et Allemagne."
  },
  en: {
    "What is AI in finance?": "AI in finance transforms financial management by automating repetitive tasks, improving forecast accuracy through predictive analytics, and enabling real-time data-driven decision making. Our solutions include fraud detection, investment optimization, and automated financial reporting.",
    "What services do you offer?": "Helvetic AI offers a comprehensive range of services:\nâ€¢ Financial process automation (P2P, O2C, R2R)\nâ€¢ EPM solutions (budgeting, forecasting, consolidation)\nâ€¢ Predictive analytics and business intelligence\nâ€¢ Risk management and compliance\nâ€¢ Training and change management\nâ€¢ 24/7 support and maintenance",
    "What are the benefits of EPM?": "EPM (Enterprise Performance Management) delivers major benefits:\nâ€¢ Real-time performance visibility\nâ€¢ More agile planning and budgeting\nâ€¢ Automated financial consolidation\nâ€¢ 90% error reduction\nâ€¢ 60% time savings on closing\nâ€¢ Improved strategic decision-making",
    "How much does AI implementation cost?": "Our solutions are modular and budget-adapted:\nâ€¢ Starter Pack: from CHF 15,000\nâ€¢ Standard Solution: CHF 50,000 - 150,000\nâ€¢ Enterprise Solution: custom quote\n\nIncludes: licenses, implementation, training, and 6 months support. ROI guaranteed in under 12 months.",
    "How do you ensure data security?": "Security is our absolute priority:\nâ€¢ ISO 27001, GDPR, and Swiss banking standards compliance\nâ€¢ End-to-end AES-256 encryption\nâ€¢ Swiss hosting with redundancy\nâ€¢ Quarterly security audits\nâ€¢ Multi-factor authentication access\nâ€¢ Automated backup and disaster recovery",
    "Can I request a demo?": "Absolutely! We offer personalized demonstrations:\nâ€¢ 30-minute live demo adapted to your needs\nâ€¢ Similar use cases presentation for your sector\nâ€¢ Q&A with our experts\nâ€¢ Tailored commercial proposal\n\nContact us at demo@helvetic-ai.ch or +41 22 123 45 67",
    "What are your client references?": "We support 150+ companies in Switzerland and Europe:\nâ€¢ Private and corporate banks\nâ€¢ Insurance and reinsurance\nâ€¢ Multinationals (pharma, luxury, technology)\nâ€¢ Growing SMEs\n\nClient satisfaction rate: 98%. References available upon request.",
    "How long does implementation take?": "Our implementation timelines are optimized:\nâ€¢ Starter Solution: 4-6 weeks\nâ€¢ Standard Solution: 2-4 months\nâ€¢ Enterprise Solution: 6-12 months\n\nAgile methodology with 2-week sprint deliverables. Progressive go-live to minimize risks.",
    "Do you provide training?": "Yes, training is an integral part of our approach:\nâ€¢ End-user training (8h)\nâ€¢ Administrator training (16h)\nâ€¢ Super-user training (24h)\nâ€¢ Personalized training materials\nâ€¢ Quarterly refresh sessions\nâ€¢ Certification available",
    "What are your partnerships?": "Helvetic AI relies on a premier partner ecosystem:\nâ€¢ Microsoft (Gold Partner Azure)\nâ€¢ SAP (Certified Partner)\nâ€¢ Oracle (Gold Partner)\nâ€¢ Tableau (Technology Partner)\nâ€¢ Integration with 200+ business applications\n\nImplementation partners in Switzerland, France, and Germany."
  },
  de: {
    "Was ist KI im Finanzwesen?": "KI im Finanzwesen transformiert das Finanzmanagement durch Automatisierung repetitiver Aufgaben, Verbesserung der Prognosegenauigkeit durch prÃ¤diktive Analysen und ermÃ¶glicht datenbasierte Entscheidungen in Echtzeit. Unsere LÃ¶sungen umfassen Betrugserkennung, Investitionsoptimierung und automatisierte Finanzberichterstattung.",
    "Welche Dienstleistungen bieten Sie an?": "Helvetic AI bietet eine umfassende Palette von Dienstleistungen:\nâ€¢ Automatisierung von Finanzprozessen (P2P, O2C, R2R)\nâ€¢ EPM-LÃ¶sungen (Budgetierung, Prognosen, Konsolidierung)\nâ€¢ PrÃ¤diktive Analysen und Business Intelligence\nâ€¢ Risikomanagement und Compliance\nâ€¢ Schulungen und Change Management\nâ€¢ 24/7 Support und Wartung",
    "Was sind die Vorteile von EPM?": "EPM (Enterprise Performance Management) bietet groÃŸe Vorteile:\nâ€¢ Echtzeit-Performance-Transparenz\nâ€¢ Agilere Planung und Budgetierung\nâ€¢ Automatisierte Finanzkonsolidierung\nâ€¢ 90% Fehlerreduktion\nâ€¢ 60% Zeitersparnis beim Closing\nâ€¢ Verbesserte strategische Entscheidungsfindung",
    "Wie viel kostet eine KI-Implementierung?": "Unsere LÃ¶sungen sind modular und budgetangepasst:\nâ€¢ Starter Paket: ab CHF 15.000\nâ€¢ Standard LÃ¶sung: CHF 50.000 - 150.000\nâ€¢ Enterprise LÃ¶sung: individuelles Angebot\n\nInklusive: Lizenzen, Implementierung, Schulung und 6 Monate Support. ROI garantiert in unter 12 Monaten.",
    "Wie garantieren Sie Datensicherheit?": "Sicherheit ist unsere absolute PrioritÃ¤t:\nâ€¢ ISO 27001, GDPR und Schweizer Banking-Standards Compliance\nâ€¢ End-to-End AES-256 VerschlÃ¼sselung\nâ€¢ Schweizer Hosting mit Redundanz\nâ€¢ VierteljÃ¤hrliche Sicherheitsaudits\nâ€¢ Multi-Faktor-Authentifizierung\nâ€¢ Automatisierte Backup und Disaster Recovery",
    "Kann ich eine Demo anfordern?": "Auf jeden Fall! Wir bieten personalisierte Demonstrationen:\nâ€¢ 30-minÃ¼tige Live-Demo angepasst an Ihre BedÃ¼rfnisse\nâ€¢ PrÃ¤sentation Ã¤hnlicher Use Cases fÃ¼r Ihre Branche\nâ€¢ Q&A mit unseren Experten\nâ€¢ MaÃŸgeschneidertes Angebot\n\nKontaktieren Sie uns unter demo@helvetic-ai.ch oder +41 22 123 45 67",
    "Was sind Ihre Kundenreferenzen?": "Wir unterstÃ¼tzen 150+ Unternehmen in der Schweiz und Europa:\nâ€¢ Privat- und Firmenbanken\nâ€¢ Versicherungen und RÃ¼ckversicherungen\nâ€¢ Multinationale Konzerne (Pharma, Luxus, Technologie)\nâ€¢ Wachsende KMU\n\nKundenzufriedenheitsrate: 98%. Referenzen auf Anfrage verfÃ¼gbar.",
    "Wie lange dauert die Implementierung?": "Unsere ImplementierungszeitrÃ¤ume sind optimiert:\nâ€¢ Starter LÃ¶sung: 4-6 Wochen\nâ€¢ Standard LÃ¶sung: 2-4 Monate\nâ€¢ Enterprise LÃ¶sung: 6-12 Monate\n\nAgile Methodik mit 2-Wochen-Sprint-Lieferungen. Progressiver Go-live zur Risikominimierung.",
    "Bieten Sie Schulungen an?": "Ja, Schulungen sind integraler Bestandteil unseres Ansatzes:\nâ€¢ Endbenutzer-Schulung (8h)\nâ€¢ Administrator-Schulung (16h)\nâ€¢ Super-User-Schulung (24h)\nâ€¢ Personalisierte Schulungsunterlagen\nâ€¢ VierteljÃ¤hrliche Auffrischungssitzungen\nâ€¢ Zertifizierung verfÃ¼gbar",
    "Was sind Ihre Partnerschaften?": "Helvetic AI stÃ¼tzt sich auf ein erstklassiges Partner-Ã–kosystem:\nâ€¢ Microsoft (Gold Partner Azure)\nâ€¢ SAP (Certified Partner)\nâ€¢ Oracle (Gold Partner)\nâ€¢ Tableau (Technology Partner)\nâ€¢ Integration mit 200+ GeschÃ¤ftsanwendungen\n\nImplementierungspartner in der Schweiz, Frankreich und Deutschland."
  }
};

// Global variables
let currentLang = "fr";
let conversationHistory = [];
let isRecording = false;
let isDarkTheme = false;
let messageCount = 0;
let ratings = [];
let currentFile = null;
let isSearchMode = false;
let searchIndex = null;

// Initialize search index
function initializeSearchIndex() {
  searchIndex = {
    fr: [],
    en: [],
    de: []
  };
  
  // Build search index for each language
  Object.keys(faq).forEach(lang => {
    Object.entries(faq[lang]).forEach(([keywords, response]) => {
      const entry = {
        keywords: keywords.toLowerCase(),
        keywordArray: keywords.toLowerCase().split(' '),
        response: response,
        category: categorizeEntry(keywords)
      };
      searchIndex[lang].push(entry);
    });
  });
}

// Categorize FAQ entries
function categorizeEntry(keywords) {
  if (keywords.includes('cout') || keywords.includes('cost') || keywords.includes('prix') || keywords.includes('tarif')) {
    return 'Prix & ROI';
  }
  if (keywords.includes('securite') || keywords.includes('security') || keywords.includes('protection')) {
    return 'SÃ©curitÃ©';
  }
  if (keywords.includes('temps') || keywords.includes('delai') || keywords.includes('timeline')) {
    return 'DÃ©lais';
  }
  if (keywords.includes('formation') || keywords.includes('training')) {
    return 'Formation';
  }
  if (keywords.includes('integration') || keywords.includes('implementation')) {
    return 'ImplÃ©mentation';
  }
  if (keywords.includes('technologie') || keywords.includes('technology') || keywords.includes('outils')) {
    return 'Technologies';
  }
  return 'GÃ©nÃ©ral';
}

// Toggle search mode
function toggleSearchMode() {
  isSearchMode = !isSearchMode;
  const searchToggle = document.getElementById('search-toggle');
  const inputContainer = document.querySelector('.input-container');
  const userInput = document.getElementById('user-input');
  
  if (isSearchMode) {
    searchToggle.classList.add('text-indigo-600');
    inputContainer.classList.add('search-active');
    userInput.placeholder = translations[currentLang].searchPlaceholder || 'Rechercher dans la base de connaissances...';
    showNotification('Mode recherche activÃ© - Tapez pour chercher');
  } else {
    searchToggle.classList.remove('text-indigo-600');
    inputContainer.classList.remove('search-active');
    userInput.placeholder = translations[currentLang].inputPlaceholder || 'Posez votre question...';
    hideSuggestions();
  }
}

// Handle input changes for search
function handleInputChange(event) {
  if (!isSearchMode) return;
  
  const query = event.target.value.trim();
  if (query.length < 2) {
    hideSuggestions();
    return;
  }
  
  performSearch(query);
}

// Perform intelligent search
function performSearch(query) {
  if (!searchIndex) initializeSearchIndex();
  
  const results = searchInKnowledgeBase(query, currentLang);
  displaySearchSuggestions(results, query);
}

// Search in knowledge base
function searchInKnowledgeBase(query, language) {
  const entries = searchIndex[language] || [];
  const queryWords = query.toLowerCase().split(' ').filter(word => word.length > 1);
  
  let results = entries.map(entry => {
    let score = 0;
    let matchedKeywords = [];
    
    queryWords.forEach(queryWord => {
      entry.keywordArray.forEach(keyword => {
        // Exact match
        if (keyword === queryWord) {
          score += 10;
          matchedKeywords.push(keyword);
        }
        // Partial match (starts with)
        else if (keyword.startsWith(queryWord) || queryWord.startsWith(keyword)) {
          score += 5;
          matchedKeywords.push(keyword);
        }
        // Contains match
        else if (keyword.includes(queryWord) || queryWord.includes(keyword)) {
          score += 2;
          matchedKeywords.push(keyword);
        }
      });
    });
    
    // Bonus for category relevance
    if (entry.category && entry.category.toLowerCase().includes(query.toLowerCase())) {
      score += 3;
    }
    
    return {
      ...entry,
      score,
      matchedKeywords: [...new Set(matchedKeywords)].slice(0, 3)
    };
  });
  
  // Filter and sort results
  results = results
    .filter(result => result.score > 0)
    .sort((a, b) => b.score - a.score)
    .slice(0, 8); // Limit to 8 results
  
  return results;
}

// Display search suggestions
function displaySearchSuggestions(results, query) {
  const container = document.getElementById('search-suggestions');
  container.innerHTML = '';
  
  if (results.length === 0) {
    container.innerHTML = `
      <div class="p-4 text-center text-gray-500">
        <i class="fas fa-search mb-2"></i>
        <div>Aucun rÃ©sultat trouvÃ© pour "${query}"</div>
        <div class="text-xs mt-1">Essayez des termes comme "IA", "budget", "ROI", "sÃ©curitÃ©"</div>
      </div>
    `;
    container.classList.remove('hidden');
    return;
  }
  
  // Group results by category
  const groupedResults = {};
  results.forEach(result => {
    const category = result.category || 'GÃ©nÃ©ral';
    if (!groupedResults[category]) {
      groupedResults[category] = [];
    }
    groupedResults[category].push(result);
  });
  
  // Display grouped results
  Object.entries(groupedResults).forEach(([category, categoryResults]) => {
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'search-category';
    categoryDiv.textContent = category;
    container.appendChild(categoryDiv);
    
    categoryResults.forEach(result => {
      const suggestionDiv = document.createElement('div');
      suggestionDiv.className = 'search-suggestion';
      
      // Highlight matching keywords in response preview
      const preview = result.response.substring(0, 100) + '...';
      const highlightedPreview = highlightMatches(preview, query);
      
      suggestionDiv.innerHTML = `
        <div class="suggestion-text">
          <div class="font-medium mb-1">${highlightedPreview}</div>
        </div>
        <div class="suggestion-keywords">
          ${result.matchedKeywords.join(', ')}
        </div>
      `;
      
      suggestionDiv.onclick = () => selectSuggestion(result.response, query);
      container.appendChild(suggestionDiv);
    });
  });
  
  container.classList.remove('hidden');
}

// Highlight matches in text
function highlightMatches(text, query) {
  const words = query.toLowerCase().split(' ');
  let highlightedText = text;
  
  words.forEach(word => {
    if (word.length > 2) {
      const regex = new RegExp(`(${word})`, 'gi');
      highlightedText = highlightedText.replace(regex, '<span class="search-highlight">$1</span>');
    }
  });
  
  return highlightedText;
}

// Select a suggestion
function selectSuggestion(response, query) {
  hideSuggestions();
  addMessage(query, 'user');
  
  setTimeout(() => {
    addMessage(response, 'bot');
  }, 500);
  
  // Clear input and exit search mode
  document.getElementById('user-input').value = '';
  if (isSearchMode) {
    toggleSearchMode();
  }
}

// Hide suggestions
function hideSuggestions() {
  document.getElementById('search-suggestions').classList.add('hidden');
}

@media (max-width: 640px) {
  .quick-actions {
    justify-content: center;
  }
  
  .dropdown-content {
    min-width: 120px;
  }
}

// Sentiment analysis simulation
function analyzeSentiment(text) {
  const positiveWords = ['excellent', 'parfait', 'super', 'gÃ©nial', 'fantastique', 'merci'];
  const negativeWords = ['problÃ¨me', 'erreur', 'mauvais', 'dÃ©faut', 'bug', 'lent'];
  
  const words = text.toLowerCase().split(' ');
  let score = 0;
  
  words.forEach(word => {
    if (positiveWords.includes(word)) score += 1;
    if (negativeWords.includes(word)) score -= 1;
  });
  
  if (score > 0) return 'positive';
  if (score < 0) return 'negative';
  return 'neutral';
}

function updateSentimentIndicator(sentiment) {
  const indicator = document.getElementById('sentiment-indicator');
  indicator.className = `sentiment-indicator sentiment-${sentiment}`;
}

// Enhanced message addition with actions and ratings
function addMessage(text, sender = "bot", isWelcome = false, showActions = true) {
  const container = document.createElement("div");
  container.className = `message-container ${sender === "user" ? "text-right" : "text-left"}`;
  
  const bubble = document.createElement("div");
  bubble.className = sender === "user" ? 
    "inline-block px-4 py-3 rounded-2xl max-w-xs lg:max-w-md text-sm font-medium message-bubble-user bg-gradient-to-r from-indigo-600 to-purple-600 text-white" :
    "inline-block px-4 py-3 rounded-2xl max-w-xs lg:max-w-md text-sm font-medium message-bubble-bot bg-white/90 backdrop-blur-sm whitespace-pre-line";

  if (isWelcome) {
    bubble.innerHTML = `
      <div id="welcome-preview" class="line-clamp-5">${text}</div>
      <button id="toggleWelcome" class="mt-2 text-indigo-600 text-xs underline">${translations[currentLang].readMore}</button>
    `;
    setTimeout(() => {
      const toggleBtn = document.getElementById("toggleWelcome");
      const preview = document.getElementById("welcome-preview");
      if (toggleBtn && preview) {
        toggleBtn.addEventListener("click", () => {
          if (toggleBtn.textContent === translations[currentLang].readMore) {
            preview.classList.remove("line-clamp-5");
            toggleBtn.textContent = translations[currentLang].readLess;
          } else {
            preview.classList.add("line-clamp-5");
            toggleBtn.textContent = translations[currentLang].readMore;
          }
        });
      }
    }, 50);
  } else {
    bubble.innerHTML = text;
  }

  container.appendChild(bubble);

  // Add message actions for bot messages
  if (sender === "bot" && showActions && !isWelcome) {
    const actions = document.createElement("div");
    actions.className = "message-actions";
    actions.innerHTML = `
      <button class="action-btn" onclick="copyMessage('${text.replace(/'/g, "\\'")}')">
        <i class="fas fa-copy mr-1"></i> Copier
      </button>
      <button class="action-btn" onclick="shareMessage('${text.replace(/'/g, "\\'")}')">
        <i class="fas fa-share mr-1"></i> Partager
      </button>
    `;
    container.appendChild(actions);

    // Add rating system
    const ratingDiv = document.createElement("div");
    ratingDiv.innerHTML = `
      <div class="text-xs text-gray-500 mt-2">${translations[currentLang].rateResponse}</div>
      <div class="satisfaction-rating">
        ${[1,2,3,4,5].map(i => `<span class="rating-star" onclick="rateMessage(${i}, this)">â­</span>`).join('')}
      </div>
    `;
    container.appendChild(ratingDiv);
  }

  document.getElementById("chatbot-messages").appendChild(container);
  document.getElementById("chatbot-messages").scrollTop = document.getElementById("chatbot-messages").scrollHeight;

  // Update conversation history
  conversationHistory.push({
    sender: sender,
    text: text,
    time: new Date().toISOString(),
    sentiment: sender === "user" ? analyzeSentiment(text) : "neutral"
  });

  messageCount++;
  updateStats();

  // Update sentiment for user messages
  if (sender === "user") {
    updateSentimentIndicator(analyzeSentiment(text));
  }
}

function showTypingIndicator() {
  const indicator = document.createElement("div");
  indicator.id = "typing-indicator";
  indicator.className = "text-left";
  indicator.innerHTML = `
    <div class="typing-indicator">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <span class="ml-2 text-xs text-gray-500">${translations[currentLang].typing}</span>
    </div>
  `;
  document.getElementById("chatbot-messages").appendChild(indicator);
  document.getElementById("chatbot-messages").scrollTop = document.getElementById("chatbot-messages").scrollHeight;
}

function hideTypingIndicator() {
  const indicator = document.getElementById("typing-indicator");
  if (indicator) {
    indicator.remove();
  }
}

// Enhanced user input handling
function handleUserInput() {
  const input = document.getElementById("user-input");
  const text = input.value.trim();
  
  if (text) {
    addMessage(text, "user");
    input.value = "";
    
    showTypingIndicator();
    
    setTimeout(() => {
      hideTypingIndicator();
      const response = responses[currentLang][text] || 
        getAIResponse(text) || 
        "DÃ©solÃ©, je n'ai pas encore de rÃ©ponse prÃ©cise pour cette question. Puis-je vous proposer une dÃ©monstration personnalisÃ©e pour mieux comprendre vos besoins ?";
      addMessage(response, "bot");
    }, 1200 + Math.random() * 800); // Variable response time
  }
}

// AI-like response generation for unknown questions
function getAIResponse(question) {
  const lowerQuestion = question.toLowerCase();
  
  if (lowerQuestion.includes('prix') || lowerQuestion.includes('coÃ»t') || lowerQuestion.includes('tarif')) {
    return "Nos tarifs dÃ©pendent de vos besoins spÃ©cifiques. Nous proposons des solutions Ã  partir de 15 000 CHF. Souhaitez-vous que je vous mette en contact avec un de nos consultants pour une estimation personnalisÃ©e ?";
  }
  
  if (lowerQuestion.includes('sÃ©curitÃ©') || lowerQuestion.includes('confidential')) {
    return "La sÃ©curitÃ© des donnÃ©es est au cÅ“ur de notre approche. Nous respectons les standards suisses et europÃ©ens les plus stricts (ISO 27001, GDPR). Toutes vos donnÃ©es restent en Suisse avec un chiffrement de niveau bancaire.";
  }
  
  if (lowerQuestion.includes('temps') || lowerQuestion.includes('durÃ©e') || lowerQuestion.includes('dÃ©lai')) {
    return "Les dÃ©lais d'implÃ©mentation varient selon la complexitÃ© : de 4 semaines pour nos solutions Starter Ã  6 mois pour les projets Enterprise. Notre approche agile garantit des rÃ©sultats rapides et mesurables.";
  }
  
  if (lowerQuestion.includes('formation') || lowerQuestion.includes('apprentissage')) {
    return "Nous incluons systÃ©matiquement la formation dans nos projets : formation des utilisateurs, administrateurs, et super-users, avec des supports personnalisÃ©s et des sessions de refresh rÃ©guliÃ¨res.";
  }
  
  return null;
}

function handleKeyPress(event) {
  if (event.key === 'Enter') {
    handleUserInput();
  }
}

// Quick actions
function handleQuickAction(action) {
  const actions = {
    fr: {
      demo: "J'aimerais voir une dÃ©monstration de vos solutions IA pour la finance.",
      contact: "Comment puis-je contacter votre Ã©quipe commerciale ?",
      pricing: "Pouvez-vous me donner plus d'informations sur vos tarifs ?"
    },
    en: {
      demo: "I would like to see a demonstration of your AI solutions for finance.",
      contact: "How can I contact your sales team?",
      pricing: "Can you give me more information about your pricing?"
    },
    de: {
      demo: "Ich mÃ¶chte eine Demonstration Ihrer KI-LÃ¶sungen fÃ¼r das Finanzwesen sehen.",
      contact: "Wie kann ich Ihr Vertriebsteam kontaktieren?",
      pricing: "KÃ¶nnen Sie mir mehr Informationen zu Ihren Preisen geben?"
    }
  };
  
  const message = actions[currentLang][action];
  if (message) {
    addMessage(message, "user");
    setTimeout(() => {
      const response = responses[currentLang][Object.values(quickQuestions[currentLang])[Object.keys(actions[currentLang]).indexOf(action)]] ||
        "Merci pour votre intÃ©rÃªt ! Je vais vous mettre en contact avec un de nos experts.";
      addMessage(response, "bot");
    }, 800);
  }
}

// File upload handling
function handleFileUpload(event) {
  const file = event.target.files[0];
  if (file) {
    currentFile = file;
    const preview = document.getElementById("file-preview");
    const previewText = document.getElementById("preview-text");
    const previewImage = document.getElementById("preview-image");
    
    preview.classList.remove("hidden");
    
    if (file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImage.src = e.target.result;
        previewImage.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
      previewText.textContent = `Image: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
    } else {
      previewImage.classList.add("hidden");
      previewText.textContent = `Document: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
    }
  }
}

function clearFilePreview() {
  document.getElementById("file-preview").classList.add("hidden");
  document.getElementById("file-input").value = "";
  currentFile = null;
}

// Voice recording
function toggleVoiceRecording() {
  const btn = document.getElementById("voice-btn");
  
  if (!isRecording) {
    startRecording();
    btn.classList.add("voice-recording");
    btn.innerHTML = '<i class="fas fa-stop"></i>';
    isRecording = true;
  } else {
    stopRecording();
    btn.classList.remove("voice-recording");
    btn.innerHTML = '<i class="fas fa-microphone"></i>';
    isRecording = false;
  }
}

function startRecording() {
  // Simulate voice recording
  console.log("Voice recording started...");
}

function stopRecording() {
  // Simulate voice recording stop
  console.log("Voice recording stopped...");
  // Here you would typically process the audio and convert to text
  const simulatedText = "Message vocal converti en texte";
  document.getElementById("user-input").value = simulatedText;
}

// Message actions
function copyMessage(text) {
  navigator.clipboard.writeText(text).then(() => {
    showNotification("Message copiÃ© !");
  });
}

function shareMessage(text) {
  if (navigator.share) {
    navigator.share({
      title: 'Helvetic AI',
      text: text
    });
  } else {
    copyMessage(text);
    showNotification("Message copiÃ© pour partage !");
  }
}

function rateMessage(rating, element) {
  // Update visual feedback
  const stars = element.parentNode.querySelectorAll('.rating-star');
  stars.forEach((star, index) => {
    if (index < rating) {
      star.classList.add('active');
    } else {
      star.classList.remove('active');
    }
  });
  
  ratings.push(rating);
  updateStats();
  showNotification("Merci pour votre Ã©valuation !");
}

// Quick questions update - Show only 3 at a time
function updateQuickQuestions() {
  const container = document.getElementById("questions-container");
  container.innerHTML = "";
  
  // Get 3 random questions
  const questions = [...quickQuestions[currentLang]].sort(() => Math.random() - 0.5).slice(0, 3);
  
  questions.forEach(question => {
    const btn = document.createElement("button");
    btn.className = "question-btn px-3 py-2 rounded-lg text-xs font-medium text-gray-700 bg-white/70 hover:bg-white transition-all border border-indigo-200 hover:border-indigo-400 hover:shadow-sm";
    btn.textContent = question;
    btn.onclick = () => {
      addMessage(question, "user");
      showTypingIndicator();
      setTimeout(() => {
        hideTypingIndicator();
        const reply = findBestMatch(question.toLowerCase(), currentLang) || 
                     getAIResponse(question) || 
                     "Merci pour cette question intÃ©ressante. Laissez-moi vous mettre en contact avec un expert.";
        addMessage(reply, "bot");
      }, 1000);
    };
    container.appendChild(btn);
  });
}

// Function to refresh quick questions
function refreshQuickQuestions() {
  updateQuickQuestions();
  showNotification("Nouvelles questions gÃ©nÃ©rÃ©es !");
}

// Theme toggle
function toggleTheme() {
  isDarkTheme = !isDarkTheme;
  const body = document.body;
  const themeBtn = document.getElementById("theme-toggle");
  
  if (isDarkTheme) {
    body.classList.add("theme-dark");
    themeBtn.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    body.classList.remove("theme-dark");
    themeBtn.innerHTML = '<i class="fas fa-moon"></i>';
  }
}

// Statistics
function updateStats() {
  document.getElementById("message-count").textContent = messageCount;
  
  if (ratings.length > 0) {
    const avgRating = ratings.reduce((a, b) => a + b, 0) / ratings.length;
    document.getElementById("avg-rating").textContent = avgRating.toFixed(1);
  }
}

function toggleStats() {
  const stats = document.getElementById("conversation-stats");
  stats.style.display = stats.style.display === "block" ? "none" : "block";
}

// Export functions
function exportConversation(format = "txt") {
  if (conversationHistory.length === 0) {
    showNotification("Aucune conversation Ã  exporter.");
    return;
  }

  let content, blob, filename;
  
  if (format === "json") {
    content = JSON.stringify({
      conversation: conversationHistory,
      stats: {
        messageCount: messageCount,
        averageRating: ratings.length > 0 ? ratings.reduce((a, b) => a + b, 0) / ratings.length : null,
        language: currentLang
      },
      exportDate: new Date().toISOString()
    }, null, 2);
    blob = new Blob([content], { type: "application/json" });
    filename = `helvetic-ai-conversation-${new Date().toISOString().split('T')[0]}.json`;
  } else if (format === "pdf") {
    // For PDF export, we'll create a formatted text version
    content = `Helvetic AI - Conversation Export
Date: ${new Date().toLocaleString()}
Language: ${currentLang.toUpperCase()}
Messages: ${messageCount}
${ratings.length > 0 ? `Average Rating: ${(ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1)}/5` : ''}

${'='.repeat(50)}

${conversationHistory.map(msg => 
  `[${new Date(msg.time).toLocaleTimeString()}] ${msg.sender.toUpperCase()}: ${msg.text}`
).join('\n\n')}`;
    blob = new Blob([content], { type: "text/plain" });
    filename = `helvetic-ai-conversation-${new Date().toISOString().split('T')[0]}.pdf`;
  } else {
    content = conversationHistory.map(msg => 
      `[${new Date(msg.time).toLocaleTimeString()}] ${msg.sender.toUpperCase()}: ${msg.text}`
    ).join('\n\n');
    blob = new Blob([content], { type: "text/plain" });
    filename = `helvetic-ai-conversation-${new Date().toISOString().split('T')[0]}.txt`;
  }

  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
  
  document.getElementById("exportDropdown").classList.remove("show");
  showNotification(`Conversation exportÃ©e en ${format.toUpperCase()} !`);
}

// Utility functions
function showNotification(message) {
  const notification = document.createElement("div");
  notification.className = "fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all";
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.opacity = "0";
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

function toggleDropdown() {
  document.getElementById("exportDropdown").classList.toggle("show");
}

// Language change handler
// Initialize the application
document.addEventListener("DOMContentLoaded", () => {
  initializeSearchIndex();
  addMessage(translations[currentLang].welcome, "bot", true);
  updateQuickQuestions();
});

// Event listeners
document.getElementById("lang-select").addEventListener("change", (e) => {
  currentLang = e.target.value;
  document.getElementById("status-indicator").textContent = translations[currentLang].online;
  
  // Update UI text
  const questionsTitle = document.querySelector("#questions-title div");
  if (questionsTitle) {
    questionsTitle.innerHTML = `<i class="fas fa-question-circle w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-indigo-500"></i>${translations[currentLang]["questions-title"]}`;
  }
  const othersBtn = document.querySelector("#questions-title button");
  if (othersBtn) {
    othersBtn.innerHTML = `<i class="fas fa-sync-alt mr-1"></i>${translations[currentLang].others}`;
  }
  
  // Clear and restart conversation
  document.getElementById("chatbot-messages").innerHTML = "";
  conversationHistory = [];
  messageCount = 0;
  ratings = [];
  
  addMessage(translations[currentLang].welcome, "bot", true);
  updateQuickQuestions();
  updateStats();
});

// Close dropdowns when clicking outside
window.addEventListener("click", (e) => {
  if (!e.target.closest("#exportDropdown")) {
    document.getElementById("exportDropdown").classList.remove("show");
  }
  if (!e.target.closest("#conversation-stats") && !e.target.matches('[onclick="toggleStats()"]')) {
    document.getElementById("conversation-stats").style.display = "none";
  }
  // Hide search suggestions when clicking outside
  if (!e.target.closest("#search-suggestions") && !e.target.closest("#user-input") && !e.target.closest("#search-toggle")) {
    hideSuggestions();
  }
});
</script>
</body>
</html>
